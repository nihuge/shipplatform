/*! 
* WeX5 v3 (http://www.justep.com) 
* Copyright 2015 Justep, Inc.
* Licensed under Apache License, Version 2.0 (http://www.apache.org/licenses/LICENSE-2.0) 
*/

define("$model/UI2/system/lib/base/viewComponent",["require","$UI/system/resources/system.res","./component","./util","./object","./message","./error","jquery","bind"],function(e){e("$UI/system/resources/system.res");var t=e("./component"),n=e("./util"),r=e("./object"),i=e("./message"),s=e("./error"),o=e("jquery"),u=e("bind"),a="bind-",f="bind-attr-",l="data-events",c="data-bind",h=["bind-click","bind-dbclick","bind-dblclick","bind-focus","bind-blur","bind-select","bind-mousedown","bind-mouseup","bind-mouseover","bind-mousemove","bind-mouseout","bind-mouseenter","bind-mouseleave","bind-keydown","bind-keyup","bind-keypress","bind-touchstart","bind-touchmove","bind-touchend","bind-abort","bind-error","bind-change","bind-reset","bind-resize","bind-submit","bind-load","bind-unload"],p=t.extend({constructor:function(e){this.__eventOperation__={},this.__events={},this.callParent(e)},constructed:function(e){this.callParent();if(e&&e.templateNode)this._bind(e.templateNode);else{e=e||{};var n=this.buildTemplate(e);if(!!n){var r=o(n)[0];this._bind(r),this._processEvents(e),this._processComponentBind(e),this._processBind(r,e),e.parentNode&&t.addComponent(e.parentNode,this)}}},_getComponentBinds:function(){var e=this.getConfig()||{};return e.binds||{}},_processComponentBind:function(e){e=e||{};var n=o(this.domNode),r=n.attr(t.COMPONENT_ATTR_NAME);if(r){var i="component:{name:'"+r+"'",s=this._getComponentBinds();for(var u in s)s.hasOwnProperty(u)&&e[u]&&(i&&(i+=","),i+=s[u]+":"+e[u]);i+="}";var a=n.attr(c);a&&(i=a+","+i),n.attr(c,i)}},_getEvents:function(){var e=this.getConfig()||{};return e.events||[]},_processEvents:function(e){if(!e)return;var t=this._getEvents();if(n.isArray(t))for(var r=0;r<t.length;r++)e[t[r]]&&(this.__events[t[r]]=e[t[r]])},_getStandardBinds:function(e,t){var n={},r=o(e),i=e.attributes;for(var s=0;s<i.length;s++){var u=i[s].name,f=i[s].value;u.indexOf(a)===0&&(n[u]=f,r.removeAttr())}t=t||{};var l=(this.getConfig()||{}).binds||{};for(var c in t)t.hasOwnProperty(c)&&c.indexOf(a)===0&&!(c in l)&&(n[c]=t[c]);return n},_processEventValue:function(e){return e&&e.indexOf(".")==-1&&e.indexOf("(")==-1?"$model._callModelFn.bind($model, '"+e+"')":e},_processBind:function(e,t){if(e.nodeType!=1)return;var n=o(e),r="",i="",s="",u="",l=this._getStandardBinds(e,t);for(var p in l)if(l.hasOwnProperty(p)){var d=l[p];h.indexOf(p)!=-1?(r=p.substring(a.length),u&&(u+=","),u+=r+":"+this._processEventValue(d)):p.indexOf(f)===0?(r=p.substring(f.length),s&&(s+=","),s+=r+":"+d):(r=p.substring(a.length),i&&(i+=","),i+=r+":"+d)}s&&(i&&(i+=","),i+="attr:{"+s+"}"),u&&(i&&(i+=","),i+="event:{"+u+"}");if(i){var v=n.attr(c);v&&(i=v+","+i),n.attr(c,i)}var m=n.children();for(var g=0;g<m.length;g++)this._processBind(m[g])},setCSS:function(e){this.$domNode.css(e)},addClass:function(e){this.$domNode.addClass(e)},toggleClass:function(e){this.$domNode.toggleClass(e)},removeClass:function(e){this.$domNode.removeClass(e)},fireEvent:function(e,t){return t&&this.domNode&&!t.hasOwnProperty("bindingContext")&&(t.bindingContext=u.contextFor(this.domNode)),this.callParent(e,t)},dispose:function(){this.domNode&&(this.getModel()._disposeComponent(this.domNode),u.utils.domData.set(this.domNode,t.BIND_NAME,null),this.domNode=null,this.$domNode=null),this.callParent()},inited:function(){this.getModel().resolvedComponent(this.domNode)},buildTemplate:function(e){},init:function(e,t){var n=this.$domNode.data("config");n&&this.set(n);var r=this.getModel(),u=o(this.domNode).attr(l);if(typeof u=="string"){var a=u.split(";");for(var f=0;f<a.length;f++){var c=a[f];if(c!==""){var h=c.indexOf(":");if(h==-1){var v=new i(i.JUSTEP230065,u);throw s.create(v)}var p=c.substring(0,h),d=c.substring(h+1);this.on(p,d,r)}}}for(var m in this.__events)this.__events.hasOwnProperty(m)&&this.on(m,this.__events[m],r);delete this.__events},update:function(e,t){if(!e)return;var n={},r=null;for(r in e)e.hasOwnProperty(r)&&(n[r]=u.utils.unwrapObservable(e[r]));if(!this._oldValues){this._oldValues=n;return}for(r in n)if(n.hasOwnProperty(r)){var i=this._oldValues[r],s=n[r];if(s!==i){var o={name:r,value:s,oldValue:i,allValue:n,oldAllValue:this._oldValues,source:this};this.fireEvent(p.DATA_CHANGED,o),this._oldValues[r]=s}}this._oldValues=n},controlsDescendantBindings:function(){return!1},getComponentByCompID:function(e){var n=this.getElementByCompID(e);return t.getComponent(n)},getElementByCompID:function(e){return this._getElementByCompID(this.domNode,e)},_getElementByCompID:function(e,n){var r=o(e);if(e!==this.domNode&&r.attr(t.COMP_ID)===n)return e;if(!r.attr(t.COMPONENT_ATTR_NAME)){var i=r.children();for(var s=0;s<i.length;s++){var u=i[s],a=this._getElementByCompID(u,n);if(a)return a}}return null},hasDisplayFunc:function(){return"function"==typeof this.getDisplayHtml||"function"==typeof this.getDisplayText},_bind:function(e){u.utils.domData.set(e,t.BIND_NAME,this),this.domNode=e,this.$domNode=o(this.domNode),u.utils.domNodeDisposal.addDisposeCallback(e,this.dispose.bind(this))}}),d=r.extend({constructor:function(e){this.comp=e.comp,this.type=e.type,this.colDef=e.colDef,this.row=e.row,this.extendType=e.extendType,this.editor=e.editor,this.readonly=e.readonly,this.bindRef=e.bindRef},getParam:function(e){if(this.editor)return this.editor.get(e);if(this.extendType)return this.extendType.getParam(e)}});return p.defaultCreateEditor=function(e,t){if(!t)return;var n={};return o.extend(n,t.getParam()),t.bindRef&&(n["bind-ref"]=t.bindRef),new e(n)},p.DisplayContext=d,p.CreateEditorContext=d,p.DATA_CHANGED="onDataChanged",p}),define("$model/UI2/system/lib/base/modelComponent",["require","./component"],function(e){var t=e("./component"),n=t.extend({});return n}),define("$model/UI2/system/lib/base/bindComponent",["require","bind","./viewComponent","./object"],function(e){var t=e("bind"),n=e("./viewComponent"),r=e("./object"),i=n.extend({constructor:function(e){this.disabled=!1,this.refDisabled=!1,this.callParent(e)},doInit:function(e,t,n){},render:function(){this.needRender=!1},isDisabled:function(){return this.disabled||this.refDisabled},dispose:function(){this._subscribeReadOnlyHandle&&this._subscribeReadOnlyHandle.dispose(),this._subscribeValidationHandle&&this._subscribeValidationHandle.dispose(),this.callParent()},val2ref:function(){if(t.isObservable(this.ref)){var e="function"!=typeof this.val?this.get("value"):this.val();this._val2ref(this.ref,e)}},_val2ref:function(e,n){t.isObservable(e)&&e.set(n)},init:function(e,t,n){this.callParent(e,t,n);var r=this.ref;e&&e.ref instanceof i.NullValue&&this.set({refDisabled:!0}),this.ref=!e||e.ref instanceof i.NullValue?null:e.ref;var s=this.doInit(e,t,n);return this.doUpdate(e,t,n),r!==this.ref&&(this._subscribeReadOnly(this.ref),this._subscribeValidation(this.ref)),this._inited=!0,this.render(),s},update:function(e,t,n){var r=this.ref;e&&e.ref instanceof i.NullValue&&this.set({refDisabled:!0}),this.ref=!e||e.ref instanceof i.NullValue?null:e.ref,this.doUpdate(e,t,n),r!==this.ref&&(this._subscribeReadOnly(this.ref),this._subscribeValidation(this.ref)),this.callParent(e,t,n)},doUpdate:function(e,t,n){e&&e.hasOwnProperty("ref")&&(this.updateValue(e.ref),this.updateReadonly(e.ref),this.updateValidation(e.ref))},_subscribeReadOnly:function(e){this._subscribeReadOnlyHandle&&this._subscribeReadOnlyHandle.dispose();if(t.isObservable(e)&&e.readonly&&t.isObservable(e.readonly.computed)){var n=this;this._subscribeReadOnlyHandle=e.readonly.computed.subscribe(function(){n.updateReadonly(e)})}},_subscribeValidation:function(e){this._subscribeValidationHandle&&this._subscribeValidationHandle.dispose();if(t.isObservable(e)&&t.isObservable(e.isValid)){var n=this;this._subscribeValidationHandle=e.isValid.subscribe(function(){n.updateValidation(e)})}},updateValue:function(e){var n=t.isObservable(e)?e.get():null;"function"!=typeof this.val?this.set({value:n}):this.val(n)},updateValidation:function(e){if(!t.isObservable(e)||!e.isValid||!e.isModified)return;var n=e.isModified.get(),r=e.isValid.get(),i=(n?!r:!1)?"addClass":"removeClass";this.$domNode[i]("has-error");var s=this.$domNode.attr("data-orig-title");null===s&&(s=this.$domNode.attr("title")),this.$domNode.attr("title",r?s:e.error.get()).attr("data-orig-title",r?null:s)},updateReadonly:function(e){if(t.isObservable(e)&&e.readonly&&"function"==typeof e.readonly.readonlyFN){e.readonly.used||(e.readonly.computed=t.computed(function(){var t=e.readonly.readonlyFN;return t.call(e.readonly.ctx.caller,e.readonly.readonlyDef,e.readonly.ctx)}),e.readonly.used=!0);var n=e.readonly.computed.get();this.set({refDisabled:n})}},disabledRender:function(){this.$domNode&&this.$domNode.attr("disabled",this.isDisabled())},propertyChangedHandler:function(e,t,n){this.$domNode&&(e==="disabled"||e==="refDisabled"?this.disabledRender():this.$domNode.attr(e,n))},set:function(e,t){e&&(this.callParent(e,t),this.needRender&&this.render())}});return i.NullValue=r.extend({toString:function(){return""}}),i}),define("$model/UI2/system/components/justep/data/js/rules",["require","$UI/system/lib/justep","$UI/system/lib/base/express","$UI/system/lib/bind/bind.validation"],function(e){function s(e,t,r){return r.$val=e,"string"==typeof t.expr&&(t.expr=new n(t.expr)),t.expr instanceof n?n.eval(t.expr,r.$row,r):!0}function o(e){return e.$data.label(e.$col)}function u(e,t,n){return r.utils.isEmptyVal(e)||t.test(e.toString())}var t=e("$UI/system/lib/justep"),n=e("$UI/system/lib/base/express");e("$UI/system/lib/bind/bind.validation");var r=t.Bind.validation,i={add:function(e,t){r.rules[e]=t,r.registerExtenders()},remove:function(e){delete r.rules[e]},isExist:function(e){return!!r.rules[e]},each:function(e){if("function"==typeof e){var t=r.rules;for(var n in t)e(n,t[n])}}};return r.rules.constraint={validator:s,message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231600,r,e.expr.expr)).getMessage()}},r.rules.required={validator:function(e,t,n){var r=/^\s+|\s+$/g,i,o=t.expr?s(e,t,n):t;return o?e===undefined||e===null?!o:(i=e,typeof e=="string"&&(i=e.replace(r,"")),(i+"").length>0):!o},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231601,r)).getMessage()}},r.rules.pattern={validator:u,message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231602,r,e)).getMessage()}},r.rules.email={validator:function(e,t,n){return t?r.utils.isEmptyVal(e)||t&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(e):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231603,r)).getMessage()}},r.rules.datetime={validator:function(e,t,n){return t?u(e,/^([12][0-9]{3})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])T([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):[0-5][0-9])?$/,n):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231604,r)).getMessage()}},r.rules.date={validator:function(e,t,n){return t?u(e,/^([12][0-9]{3})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])(Z|[+-]([01][0-9]|2[0-3]):[0-5][0-9])?$/,n):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231605,r)).getMessage()}},r.rules.time={validator:function(e,t,n){return t?u(e,/^([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9](\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):[0-5][0-9])?$/,n):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231606,r)).getMessage()}},r.rules.number={validator:function(e,t,n){return t?r.utils.isEmptyVal(e)||t&&/^(([-+]?([0-9]+(\.[0-9]*)?)|(\.[0-9]+))([eE][-+]?[0-9]+)?|-?INF|NaN)$/.test(e):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231607,r)).getMessage()}},r.rules.integer={validator:function(e,t,n){return t?r.utils.isEmptyVal(e)||t&&/^\d+$/.test(e):!0},message:function(e,n){var r=o(n);return(new t.Message(t.Message.JUSTEP231608,r)).getMessage()}},r.registerExtenders(),i}),define("$model/UI2/system/components/justep/data/js/extendType",["require","$UI/system/lib/justep","jquery"],function(e){var t=e("$UI/system/lib/justep"),n=e("jquery"),r=t.Object.extend({constructor:function(e,t,n){this.callParent(),this.data=e,this.col=t,this._def=n},getParam:function(e){this._param||("string"==typeof this._def.param?this._param=n.parseJSON(this._def.param):this._def.param&&(this._param=this._def.param));if(this._param)return e?this._param[e]:this._param},getModel:function(){return this.data.getModel()},getEditor:function(){var e=this._def.editor;if(e)return e;var t=u(this.getModel(),this._def.name);if(t)return t.editor}}),i="__ExtendTypes__",s=function(e){return this[i]};r.registerExtendType=function(e,n){if(!(e instanceof t.ModelBase)){var r=new t.Message(t.Message.JUSTEP231102,n.name);throw t.Error.create(r)}typeof e.getExtendTypes!="function"&&(e.getExtendTypes=s),e[i]||(e[i]={}),e[i][n.name]=n},r.unregisterExtendType=function(e,t){if(e[i]){var n=e[i];n[t]&&delete n[t]}},r.getEditor=function(e,t){var n=r.getExtendTypeObject(e,t);if(n)return n.getEditor()};var o=function(e){if(e&&e.define){var t=e.define;return t.defCol?t.defCol.extendType:null}},u=function(e,t){return e[i][t]};r.getExtendTypeDef=function(e,t){if(e&&e[i]&&t&&t.define){var n=o(t);if(n)return u(e,n.name)}};var a=function(e,t){var n=u(e,t);if(n)return n["class"]};return r.getExtendTypeClass=function(e,t){var n=r.getExtendTypeDef(e,t);if(n)return n["class"]},r.getExtendTypeObject=function(e,t){if(e&&e[i]&&t&&t.define){var n=o(t);if(n){if(n.object)return n.object;var r=a(e,n.name);if(r){var s=t.define;return n.object=new r(s.data,s.col,n),n.object}}}},r.getExtendTypeObjectByColDef=function(e,t){if(e&&t){var n=e.getModel(),r=t.extendType;if(n&&n[i]&&r){if(r.object)return r.object;var s=a(n,r.name);if(s)return r.object=new s(e,t.name,r),r.object}}},r}),define("$model/UI2/system/components/justep/data/data",["require","jquery","$UI/system/lib/justep","./js/rules","./js/extendType","$UI/system/lib/bind/bind.validation","$UI/system/resources/system.res"],function(require){var $=require("jquery"),justep=require("$UI/system/lib/justep"),Bind=justep.Bind,Model=justep.ModelBase,Expr=justep.Express,Rules=require("./js/rules"),ExtendType=require("./js/extendType");require("$UI/system/lib/bind/bind.validation"),require("$UI/system/resources/system.res");var Row=justep.Object.extend({constructor:function(e,t){this.data=e,this.row=t},ref:function(e){var t=this.row[e];return t?t.value:undefined},val:function(e,t){if(arguments.length==1)return this.data.getValue(e,this);this.data.setValue(e,t,this)},oval:function(e){return this.data.getOriginalValue(e,this)},label:function(e){return this.data.label(e)},parent:function(){return this.row.userdata?this.row.userdata.parent:undefined},index:function(){return this.data.getRowIndex(this)},hasChildren:function(){return this.rows&&this.rows.get().length>0},getChildren:function(){return this.children()},children:function(){return this.rows?this.rows.get():undefined},getID:function(){return this.data.getRowID(this)},assign:function(e,t){if(e instanceof Row){var n;if($.isArray(t))for(var r=0;r<t.length;r++)n=t[r],this.val(n,e.val(n));else for(n in this.data.defCols)this.val(n,e.val(n))}}}),date2Val=function(e){return e instanceof Date?justep.Date.toString(e,justep.Date.STANDART_FORMAT_SHOT):e},time2Val=function(e){return e instanceof Date?justep.Date.toString(e,justep.Date.STANDART_TIME_FORMAT):e},dateTime2Val=function(e){return e instanceof Date?justep.Date.toString(e,justep.Date.STANDART_FORMAT):e},Data=justep.ModelComponent.extend({constructor:function(e,t){this.callParent(),this.clz=Data,this.autoLoad=!1,this.autoNew=!1,this.isMainData=!1,this.delim=",",this.versionRelation="version",this.updateMode="whereVersion",this.distinct=null,this.defTreeOption={isTree:!1},this.orderBys=[],this.userdata={},this.directDeleteMode=!1,this.confirmDelete=!0,this.confirmDeleteText=justep.Message.getMessage(justep.Message.JUSTEP231000),this.confirmRefresh=!0,this.confirmRefreshText=justep.Message.getMessage(justep.Message.JUSTEP231001),this.offset=0,this.limit=20,this.dataType="json",this.xid=t?t.xid:"",this.currentRow=Bind.observable(),this.datas=this.allDatas=Bind.observableArray(),this.allDatas.owner=this,this.setTotal(0),this.deleteDatas=Bind.observableArray(),this.slaveDatas=[],this.isModified=Bind.observable(!1),this._isModelConctructed=Bind.observable(!1),this.clientFilter="",this._clientFilterExpr=Bind.observable(),this.isChanged=function(){return this.isSelfChanged()||this.isSlaveChanged()},this._init(e,t)},_getSelfValid:function(){var e=!0;return this.eachAll(function(t){var n=t.row,r=n.row.userdata.recordState;if(Data.STATE.NEW==r||Data.STATE.EDIT==r)for(var i in t.data.defCols){var s=n.ref(i);if(s&&Bind.isObservable(s.isValid)&&!s.isValid.get()){e=!1,t.cancel=!0;break}}}),e},_getSelfInvalidInfo:function(){var e=[];return this.eachAll(function(t){var n=t.row,r=n.row.userdata.recordState;if(Data.STATE.NEW==r||Data.STATE.EDIT==r)for(var i in t.data.defCols){var s=n.ref(i);if(s&&Bind.isObservable(s.error)){var o=s.error.get();o&&e.push(o)}}}),e.join(";")},getReadonly:function(e,t){if(e&&t){var n=t.ref(e);return n&&n.readonly&&n.readonly.used?n.readonly.computed.get():this.readonly.get()}return this.readonly.get()},setClientFilter:function(e){this.clientFilter=e;var t=null;e&&"string"==typeof e&&(t=new Expr(e)),this._clientFilterExpr.set(t)},clone:function(e){var t=$.extend({},this.definition);return t.xid=e||Data.UUID(),delete t.master,delete t.autoLoad,delete t.autoNew,new this.clz(this.getModel(),t)},_dispose:function(e){if(Bind.isObservable(e))e.extend({validatable:!1,readonly:!1}),e.getSubscriptionsCount()>0&&(e._subscriptions.change=[]);else if(Bind.isComputed(e))e.extend({validatable:!1,readonly:!1}),e.target&&(this._dispose(e.target),delete e.target),e.dispose();else if(Bind.validation.utils.isObservableArray(e)){var t=e.get(),n=0;for(;n<t.length;n++){var r=t[n].row;r.userdata&&r.userdata.isModified&&this._dispose(r.userdata.isModified);for(var i in this.defCols)this._dispose(r.ref(i))}e.destroyAll()}},dispose:function(){Data.unRegisterData(this.getModel(),this.xid),this._dispose(this.readonly),this._dispose(this.index),this._dispose(this.indexParent),this._dispose(this.currentRow),this._dispose(this.isModified),this._dispose(this._clientFilterExpr),this._dispose(this.allDatas),this._dispose(this.deleteDatas),delete this.readonly,delete this.index,delete this.indexParent,delete this.currentRow,delete this.isModified,delete this._clientFilterExpr,delete this.allDatas,delete this.deleteDatas},createErrorValue:function(e){return Data.createErrorValue(e)},getContext:function(){return this.getModel().getContext()},label:function(e){var t=this.defCols[e];return t?t.label!==undefined&&t.label!==null?t.label:e:""},_setLoaded:function(e,t){t?(t.row.userdata||(t.row.userdate={}),t.row.userdata._loaded=e):this.loaded=e},open:function(){this.isLoaded()||this.refreshData()},isLoaded:function(e){return!e||this.defTreeOption.isTree&&!this.defTreeOption.option.isDelayLoad?this.loaded:e.row.userdata&&e.row.userdata._loaded?e.row.userdata._loaded:!1},hasMore:function(e){if(this.limit==-1)return!1;var t=e?e.rows?e.rows.get():[]:this.datas.get();return this.getTotal(e)>t.length},getTotal:function(e){return this.limit!==-1?e?e.row.userdata&&e.row.userdata._total?e.row.userdata._total.get():0:this.total.get():this.getCount(e)},setTotal:function(e,t){t?(t.row.userdata||(t.row.userdata={}),t.row.userdata._total||(t.row.userdata._total=Bind.observable()),t.row.userdata._total.set(e)):(this.total||(this.total=Bind.observable()),this.total.set(e))},getOffset:function(e){return e?e.row.userdata&&e.row.userdata._offset?e.row.userdata._offset:0:this.offset},setOffset:function(e,t){t?(t.row.userdata||(t.row.userdata={}),t.row.userdata._offset=e):this.offset=e},ref:function(e,t){return this._inited?(typeof t!="object"&&(t=this.getCurrentRow()),t?t.ref(e):new Data.NullValue):new Data.NullValue},val:function(e,t){return this.getValue(e,t)},eachAll:function(e,t,n){if("function"!=typeof e)return;var r=n?Bind.isObservable(n.rows)?n.rows.get():[]:this.allDatas.get(),i=r.length;for(var s=0;s<i;s++){var o={index:s,row:r[s],cancel:!1,parent:n,data:this};e.call(t||o.row,o);if(o.cancel)return;if(Bind.isObservable(o.row.rows)&&!this.eachAll(e,t,o.row))return}return!0},each:function(e,t,n){this.eachAll(e,t,n?n:{rows:this.datas})},getChildren:function(e){return e?Bind.isObservable(e.rows)?e.rows.get():[]:this.datas.get()},isSelfChanged:function(){var e=!1;return this.eachAll(function(t){var n=t.row.row.userdata.recordState;if(Data.STATE.NEW==n||Data.STATE.EDIT==n)e=!0,t.cancel=!0}),e||this.deleteDatas.get().length>0},isSlaveChanged:function(){var e=this.slaveDatas.length;for(var t=0;t<e;t++)if(this.slaveDatas[t].isChanged())return!0;return!1},_bindClientFilter:function(){(!this.master||!this.master.xid)&&this.clientFilter&&(this.datas=this._filterBy())},_bindMaster:function(){this.master&&!this.master.masterData&&this.master.xid&&(this.master.masterData=Data.$(this.getModel(),this.master.xid),this.master.masterData&&(this.master.masterData.slaveDatas.push(this),this.byMaster={},this.datas=this._filterBy(),this.setTotal(0),this.datas.subscribe(function(e){var t={};t.source=this,this.fireEvent(Data.EVENT_SLAVEDATAS_CHANGED,t),t.changedSource=this,t.type="slaveDataChanged",t.selfChanged=!0,this.doDataChanged(t)},this),this.master.masterData.currentRow.subscribe(function(e){if(undefined===e)return;var t=this.master.masterData.getRowID(e);this.byMaster[t]||(this.byMaster[t]={}),this.byMaster[t].current=this.getCurrentRow(!0),this.byMaster[t].offset=this.getOffset(),this.byMaster[t].total=this.getTotal()},this,"beforeChange")))},_clientFilter:function(e){var t=[],n=this._clientFilterExpr.get();if(n instanceof Expr)for(var r=0;r<e.length;r++){var i=e[r],s={$model:this.getModel(),$data:this,$row:i};Expr.eval(n,i,s)&&t.push(i)}else t=e;return t},_createReadonly:function(){typeof this.definition.readonly=="string"&&(this.definition.readonly=new Expr(this.definition.readonly));var e=this.getContext();this.readonly=Bind.computed(function(){var t={$model:this.getModel(),$data:this};return e&&"function"==typeof e.isReadonlyMode&&e.isReadonlyMode()||(this.definition.readonly instanceof Expr?Expr.eval(this.definition.readonly,this,t):this.definition.readonly)},this)},_init:function(e,t){if(!e||!t)return;this.setModel(e),this.definition=t,this._createReadonly(),this._initDefinition(),this.attachEvents(t.events);var n=function(){this._bindClientFilter(),this._bindMaster(),Data.registerData(e,this.xid,this);var t={source:this};this.fireEvent(Data.EVENT_CREATE,t),this.getModel().resolvedComponent(this.xid),this._inited=!0},r=this,i=function(e){r._isModelConctructed.set(!0),r._initExtendType(),r.autoNew&&!r.master?r.newData():r.autoLoad&&!r.master&&r.open()};e.isConctructed()?i():e.on(Model.MODEL_CONSTRUCTING_EVENT,i),n.call(r)},_initDefinition:function(){this.dataModel=this.definition.dataModel||"",this.definition.autoLoad&&(this.autoLoad=!0),this.definition.autoNew&&(this.autoNew=!0),this.definition.limit&&(this.limit=this.definition.limit),this.definition.offset&&this.setOffset(this.definition.offset),this.definition.directDelete&&(this.directDeleteMode=this.definition.directDelete),this.definition.confirmDelete===!1&&(this.confirmDelete=!1),this.definition.confirmDeleteText&&(this.confirmDeleteText=this.definition.confirmDeleteText),this.definition.confirmRefresh===!1&&(this.confirmRefresh=!1),this.definition.confirmRefreshText&&(this.confirmRefreshText=this.definition.confirmRefreshText),this.definition.filterRelations&&(this.defFilterRelations=this.definition.filterRelations),this.definition.updateMode&&(this.updateMode=this.definition.updateMode),this.definition.orderBys&&(this.orderBys=this.definition.orderBys),this.definition.clientFilter&&this.setClientFilter(this.definition.clientFilter);var e=this.definition.filters;for(var t in e)this.setFilter(t,e[t]);this.concept=this.definition.concept,this.idColumn=this.definition.idColumn,this.defaultValues=this.definition.defaultValues,this._initDefCols(),this._initRules(),this.defAggCols=this.definition.defAggCols,this.master=this.definition.master,this.definition.treeOption?(this.defTreeOption.isTree=!0,this.defTreeOption.option=this.definition.treeOption):this.defTreeOption.option={}},getTreeOption:function(){return this.defTreeOption.option},_initExtendType:function(){for(var e in this.defCols)ExtendType.getExtendTypeObjectByColDef(this,this.defCols[e])},_initDefCols:function(){this.defCols=this.definition.defCols},_initRules:function(){for(var e in this.defCols){var t=this.defCols[e].rules;if(t&&!Bind.validation.utils.isObservableArray(t)){var n=[];for(var r in t){if("readonly"==r||"calculate"==r){this.defCols[e][r]=t[r],delete t[r];continue}var i=t[r];i&&(i.message||i.onlyIf)?n.push({rule:r,message:i.message,params:Bind.validation.utils.isEmptyVal(i.params)?!0:i.params,condition:i.onlyIf}):n.push({rule:r,params:i.params?i.params:i})}n.length>0?this.defCols[e].rules=Bind.observableArray(n):delete this.defCols[e].rules}}},addRule:function(e,t){var n=this.defCols[e];n&&(n.rules?n.rules.push(t):n.rules=Bind.observableArray([t]))},buildFilter:function(){return""},getFilter:function(e){return""},setFilter:function(e,t){return""},setOrderBy:function(e,t){var n=this._getOrderBy(e);if(null!==t&&undefined!==t)n?n.type=t:this.orderBys.push({relation:e,type:t});else if(n){var r=this.orderBys.indexOf(n);r>=0&&this.orderBys.splice(r,1)}},_getOrderBy:function(e){var t;return $.each(this.orderBys,function(n,r){if(r.relation==e)return t=r,!1}),t},getOrderBy:function(e){var t=this._getOrderBy(e);return t?t.type:t},clearOrderBy:function(){this.orderBys=[]},getOrderBys:function(){var e="";for(var t=0;t<this.orderBys.length;t++){var n=this.orderBys[t];e+=(e!==""?",":"")+n.relation+(0===n.type?" DESC":" ASC")}return e},sort:function(e){},exchangeRow:function(e,t){var n=this.allDatas.indexOf(e);if(n<0)return;var r=this.allDatas.indexOf(t);if(r<0)return;this.allDatas.splice(n,1,t),this.allDatas.splice(r,1,e);var i={source:this,changedSource:this,row1:e,row2:t,type:"exchangeRow",selfChanged:!0};this.doDataChanged(i)},getResultRelations:function(){var e=null;for(var t in this.defCols)this.isUICalculateCol(t)||(e=null!==e?e+this.delim+t:t);return e},getColumnIDs:function(){var e=null;for(var t in this.defCols)e=null!==e?e+this.delim+t:t;return e},getAggRelations:function(){var e="";for(var t in this.defAggCols)e+=""!==e?this.delim+t:t;return e},doDataChanged:function(e){var t={};this.hasListener(Data.EVENT_DATA_CHANGE)&&(justep.Util.apply(t,e),this.fireEvent(Data.EVENT_DATA_CHANGE,t));if(this.master&&this.master.masterData){var n=this.master.masterData;n&&(t=$.extend({},e),t.source=n,t.selfChanged=!1,n.doDataChanged(t))}},attachEvents:function(events){if(!events)return;typeof events=="string"&&(events=eval("("+events+")"));if(!events)return;for(var o in events){var func=events[o];if(typeof func=="string")with(this.getModel()||window)func=eval("("+func+")");typeof func=="function"&&this.on(o,func,this.getModel())}},_clear:function(e){(!e||this.isChild(this.getCurrentRow(!0),e))&&this.currentRow.set();var t,n=null;if(!e){t=this.allDatas.get();for(n in t)this._clear(t[n]);this.allDatas.removeAll(),this.deleteDatas.removeAll()}else{if(e.rows){t=e.rows.get();for(n in t)this._clear(t[n]);e.rows.removeAll()}var r=this.deleteDatas.get();for(var i=0;i<r.length;i++)this.isChild(r[i],e)&&this.deleteDatas.splice(i,1)}},isChild:function(e,t){if(!e)return!1;var n=e.parent();return n===t?!0:n?this.isChild(n,t):!1},clear:function(e){this._clear(e);var t={};t.source=this,t.changedSource=this,t.type="clear",t.selfChanged=!0,t.parent=e,this.doDataChanged(t)},_reloadDefByUserData:function(e,t){t||justep.Util.apply(this.userdata,e),typeof e=="object"&&(e.hasOwnProperty("sys.loaded")&&this._setLoaded(e["sys.loaded"],t),e.hasOwnProperty("sys.count")&&this.setTotal(e["sys.count"],t),e.hasOwnProperty("sys.offset")&&this.setOffset(e["sys.offset"],t))},loadData:function(e,t,n,r){r=undefined===r?-1:r;var i=[];$.isArray(e)&&(e={rows:e});if(e&&("table"==e["@type"]||$.isArray(e.rows))){t||this._clear(n),this._reloadDefByUserData(e.userdata,n);var s=e.rows?e.rows:[],o=[];for(var u=0;u<s.length;u++){var a=s[u];a.userdata&&a.userdata.id&&(a[this.idColumn]=a.userdata.id,delete a.userdata.id);var f=this.add(a,n,!0,!0);o.push(f),i.push(f),a.rows&&i.push(i,this.loadData(a,t,f))}n?n.rows?-1==r?n.rows.push.apply(n.rows,o):n.rows.splice.apply(n.rows,[r,0].concat(o)):n.rows=Bind.observableArray(o):-1==r?this.allDatas.push.apply(this.allDatas,o):this.allDatas.splice.apply(this.allDatas,[r,0].concat(o))}return i},isExist:function(e){return this.exist(e)},exist:function(e){var t=!1;return this.each(function(n){e==this.getRowID(n.row)&&(n.cancel=!0,t=!0)},this),t},getUserData:function(e,t){return t?t.row.userdata[e]:this.userdata[e]},getAggregateValue:function(e,t){return this.getUserData(e,t)},setUserData:function(e,t,n){var r=n?n.row.userdata:this.userdata;r[e]=t},find:function(e,t,n,r,i,s){var o=[],u=0;t&&e&&(u=t.length>e.length?e.length:t.length);if(u>0){var a=s?"eachAll":"each";this[a](function(s){var a=!0,f=s.row;for(var l=0;l<u;l++){var c=this.getValue(e[l],f);if(typeof c=="string"){c=r?c.toLowerCase():c;var h=r?(t[l]+"").toLowerCase():t[l];a=a&&(i?c.indexOf(h)!=-1:c==h)}else a=t[l]==c;if(!a)break}a&&(o.push(f),n&&(s.cancel=!0))},this)}return o},isValid:function(){return this._getSelfValid()&&function(){for(var e=0;e<this.slaveDatas.length;e++)if(!this.slaveDatas[e].isValid())return!1;return!0}.call(this)},getInvalidInfo:function(){var e="";for(var t=0;t<this.slaveDatas.length;t++)e+=this.slaveDatas[t]._getSelfInvalidInfo()+"\n";return this._getSelfInvalidInfo()+"\n"+e},convert:function(e,t){return Data.convert(e,t)},_filterBy:function(){var e,t;return this.master?(e=Bind.computed(function(){var e=this.master.masterData,n=this._isModelConctructed.get(),r=e.getCurrentRow(),s=e.getRowID(r),o=this.allDatas.get();if(undefined===r||!n)return[];var u=this.byMaster[s];if(!u||!u.loaded){var a={source:this,masterRow:r,loaded:Data.STATE.NEW===e.getRowState(r)};this.fireEvent(Data.EVENT_LOAD_SLAVEDATA,a),!a.loaded&&this.autoLoad&&Data.STATE.NEW!==e.getRowState(r)&&(a.loaded=this._refreshData({append:!0,offset:0})),u?u.loaded=a.loaded:this.byMaster[s]={loaded:a.loaded}}var f=[];for(t=0;t<o.length;t++){var l=o[t];Bind.unwrap(l.ref(this.master.relation).get())===s&&f.push(l)}return this.clientFilter&&(f=this._clientFilter(f)),u&&u.loaded?(this.currentRow.set(u.current),u.offset!==undefined?this.setOffset(u.offset):"",u.total!==undefined?this.setTotal(u.total):""):f.length>0?this.currentRow.set(f[0]):this.currentRow.set(null),f},this),e.owner=this,e):this.clientFilter?(e=Bind.computed(function(){var e=this._isModelConctructed.get();if(!e)return[];var t=this.allDatas.get(),n;if(this.clientFilter){t=this._clientFilter(t);var r=this.getCurrentRow(!0);$.each(t,function(e,t){if(t===r)return n=r,!1})}return n&&this.currentRow.set(n),t.length>0?this.currentRow.set(t[0]):this.currentRow.set(null),t},this),e.owner=this,e):this.allDatas},bindRules:function(e,t,n,r){return t&&e.extend({validatable:{enable:!0,rules:t,isModified:n,ctx:r}}),e},_doReadonly:function(e,t){return this.readonly.get()||e instanceof Expr&&Expr.eval(e,t.$row,t)},bindReadonly:function(e,t,n){return n.caller=this,e.extend({readonly:{readonlyFN:this._doReadonly,readonlyDef:t,ctx:n}}),e},bindCalculate:function(e,t,n){var r=Bind.computed({read:function(){if(!this._inited)return"";var r=e.get(),i=Expr.eval(t,n.$row,n);return i!==r&&window.setTimeout(function(){e.set(i)},1),i},write:function(t){e.set(t)}},this);return r.target=e,r},getParentRelation:function(){return this.defTreeOption.isTree?this.defTreeOption.option.parentRelation:""},bindValueChange:function(e,t){var n=Bind.observable(e);return n.subscribe(function(e){e.newValue!==e.oldValue&&(e.source=t.data,e.row=t.row,e.col=t.col,t.handler.call(t.caller,e))},null,"changing"),n.subscribe(function(e){var n={source:t.data,row:t.row,col:t.col,value:e};t.handler.call(t.caller,n,!0)}),n},disableRecordChange:function(){this._disableRecordChange=!0},enabledRecordChange:function(){this._disableRecordChange=!1},canRecordChange:function(){return!this._disableRecordChange},isCalculateCol:function(e){if(e){"string"==typeof e&&(e=this.defCols[e]);if("object"==typeof e)return"EXPRESS"===e.relation||"STATISTICAL"==e.relation}},isUICalculateCol:function(e){if(e){"string"==typeof e&&(e=this.defCols[e]);if("object"==typeof e)return!e.isBiz&&("EXPRESS"===e.relation||"STATISTICAL"==e.relation)}},_doValueChange:function(e,t){if(e.col===this.versionRelation||!this.canRecordChange())return;if(!t){this.fireEvent(Data.EVENT_VALUE_CHANGE,e);if(!this.isCalculateCol(e.col)&&e.oldValue!==e.newValue){var n=e.row;if(n){var r=n.row.userdata.recordState;if(r!==Data.STATE.NEW){var i=n.row[e.col];1!==i.changed&&(i.originalValue=e.oldValue,n.row.userdata.recordState=Data.STATE.EDIT,i.changed=1,n.row.userdata.isModified.set(!0),this.isModified.set(!0))}}}}else this.fireEvent(Data.EVENT_VALUE_CHANGED,e),e.changedSource=this,e.type="valueChanged",e.selfChanged=!0,this.doDataChanged(e);Data.debug&&console.log("行["+e.rowID+"]列["+e.col+"]changed,"+"old:"+e.oldValue+",newValue:"+e.newValue)},getRowByID:function(e,t){if(e!==undefined){var n=null,r=t?"eachAll":"each";return this[r](function(t){e==this.getRowID(t.row)&&(t.cancel=!0,n=t.row)},this),n}return this.getCurrentRow(!0)},getValue:function(e,t){t||(t=this.getCurrentRow());var n=t?t.ref(e):undefined,r=this.defCols?this.defCols[e]:null;return this.convert(Bind.isObservable(n)?n.get():n,r?r.type:"String")},getOriginalValue:function(e,t){t||(t=this.getCurrentRow());var n=t?t.row[e]:undefined,r=this.defCols?this.defCols[e]:null;return this.convert(n.originalValue,r?r.type:"String")},setValue:function(e,t,n){n||(n=this.getCurrentRow(!0));var r=n?n.ref(e):undefined,i=this.defCols[e],s=i?i.type:"String";Bind.isObservable(r)&&(s==="DateTime"?t=dateTime2Val(t):s==="Date"?t=date2Val(t):s==="Time"&&(t=time2Val(t)),r.set(t))},getValueByID:function(e,t){return this.getValue(e,this.getRowByID(t,!0))},setValueByID:function(e,t,n){this.setValue(e,t,this.getRowByID(n,!0))},getRowState:function(e){return e&&e.row.userdata&&e.row.userdata.recordState?e.row.userdata.recordState:Data.STATE.NONE},setRowState:function(e,t){e&&e.row.userdata&&(e.row.userdata.recordState=t,(t===Data.STATE.NEW||t===Data.STATE.EDIT&&Bind.isObservable(e.row.userdata.isModified))&&e.row.userdata.isModified.set(!0))},getRowID:function(e){return e===undefined&&(e=this.getCurrentRow(!0)),e?e.ref(this.idColumn).get():undefined},getRowIndex:function(e){var t=this.datas.get();return $.isArray(t)?t.indexOf(e):-1},to:function(e){typeof e=="string"&&(e=this.getRowByID(e));if((e instanceof Data.Row||e===undefined||e===null)&&e!==this.getCurrentRow(!0)){var t={source:this,row:e,originalRow:this.getCurrentRow(!0),cancel:!1};this.fireEvent(Data.EVENT_INDEX_CHANGING,t);if(t.cancel)return;this.currentRow.set(e),this.fireEvent(Data.EVENT_INDEX_CHANGED,t)}},getCount:function(e){if(!this.defTreeOption.isTree)return this.datas.get().length;var t=0;return this.each(function(){t++},this,e),t},next:function(){var e=this.getCurrentRow(!0),t=!1;this.each(function(n){t&&(this.to(n.row),n.cancel=!0,t=!1),n.row==e&&(t=!0)},this)},pre:function(){var e=this.getCurrentRow(!0),t=null;this.each(function(n){n.row==e&&(null!==t&&this.to(t),n.cancel=!0,t=null),t=n.row},this)},first:function(){this.to(this.getFirstRow())},last:function(){this.to(this.getLastRow())},getFirstRow:function(){var e=this.datas.get();return e.length>0?e[0]:null},getLastRow:function(){var e=this.datas.get();return e.length>0?this._lastRow(e):null},getCurrentRow:function(e){return this.currentRow[e?"peek":"get"]()},getCurrentRowID:function(){return this.getRowID(this.getCurrentRow(!0))},_lastRow:function(e){var t=e.length,n=e[t-1];return t>0&&n.rows?this._lastRow(n.rows.get()):n},isLeaf:function(e){return this.defTreeOption.isTree&&e?e.row[this.defTreeOption.option.nodeKindRelation]?Data.NODE_KIND_LEAF==e.ref(this.defTreeOption.option.nodeKindRelation).get():!1:!0},isTree:function(){return this.defTreeOption&&this.defTreeOption.isTree},newData:function(e){var t=-1,n=null,r=null,i=null,s=null,o=!1,u={cancel:!1,option:e,options:e,source:this};this.fireEvent(Data.EVENT_NEWDATA_BEFORE,u);if(u.cancel)return null;arguments.length==1&&typeof e=="object"&&(t=e.hasOwnProperty("index")?e.index:t,n=e.parent,r=e.defaultValues,i=e.onSuccess,s=e.onError);var a=null;this.hasListener(Data.EVENT_NEWDATA)?(u={data:a,option:e,options:e,async:!1,source:this},this.fireEvent(Data.EVENT_NEWDATA,u),a=u.data,o=u.async):a=this.doNewData(r,e);if(!a)return null;r=this.loadData(a,!0,n,t);if(r.length>0){if(this.isTree()){var f=this.getTreeOption();if(f.nodeKindRelation){for(var l=0;l<r.length;l++){var c=r[l];c.val(f.nodeKindRelation,Data.NODE_KIND_LEAF)}n&&n.val(f.nodeKindRelation,"")}}this.to(r[0])}return u={rows:r,option:e,options:e,source:this},this.fireEvent(Data.EVENT_NEWDATA_AFTER,u),u.changedSource=this,u.type="new",u.selfChanged=!0,this.doDataChanged(u),this._setLoaded(!0,n),i&&$.isFunction(i)&&i({source:this,option:e,options:e,rows:r}),r},doNewAfter:function(){},doNewData:function(e,t){if(!e||e.length<=0)e=[{}];var n={rows:[],userData:{},"@type":"table"};for(var r=0;r<e.length;r++){var i=e[r];i.userdata||(i.userdata={}),i.userdata.recordState=Data.STATE.NEW,n.rows.push(i)}return n},_beginBatch:function(){return!0},_cancelBatch:function(){return!0},_endBatch:function(){return!0},saveData:function(e){var t=null,n=null,r=!0,i=!1,s=!1;arguments.length==1&&typeof e=="object"&&(i=!!e.ignoreInvalid,undefined!==e.useTrans&&(r=!!e.useTrans),t=e.onSuccess,n=e.onError,e=$.extend({},e));var o=!1;if(!this.isChanged())return!0;if(!i&&!this.isValid())throw justep.Error.create(this.getInvalidInfo());if(!1!==r&&!this._beginBatch()){var u=new justep.Message(justep.Message.JUSTEP231019);throw justep.Error.create(u)}try{var a={cancel:!1,source:this,options:e};this.fireEvent(Data.EVENT_SAVEDATA_BEFORE,a);if(a.cancel)return!1!==r&&this._cancelBatch(),!1;if(this.hasListener(Data.EVENT_SAVEDATA))a={cancel:!1,source:this,async:!1,options:e},this.fireEvent(Data.EVENT_SAVEDATA,a),s=a.async,o=!a.cancel;else{var f=this.doSaveData(e);$.isPlainObject(f)?(o=f.success,s=f.async):o=f}if(!o)return!1!==r&&this._cancelBatch(),!1;s||this.doSaveAfter(o,e),a={cancel:!1,options:e,source:this},this.fireEvent(Data.EVENT_SAVEDATA_AFTER,a);if(a.cancel)return!1!==r&&this._cancelBatch(),!1}catch(l){!1!==r&&this._cancelBatch();var u=new justep.Message(justep.Message.JUSTEP231020,l.message||l);throw justep.Error.create(u)}return!1!==r&&this._endBatch(),!0},doSlaveDataSave:function(){var e=this.slaveDatas.length;for(var t=0;t<e;t++){var n=this.slaveDatas[t];if(n&&!n.saveData({useTrans:!1,ignoreInvalid:!0}))return!1}return!0},doSaveData:function(e){var t=e&&e.onlySelf||!1;return t||this.doSlaveDataSave()},doSaveAfter:function(e,t,n){t=t||{},n=n||{};var r=t.onError,i=t.onSuccess;n.source||(n.source=this),e?(this.applyUpdates(n,t),i&&$.isFunction(i)&&i(n),this.fireEvent(Data.EVENT_SAVE_COMMIT,n)):(r&&$.isFunction(r)&&r(n),this.hasListener(Data.EVENT_SAVEDATA_ERROR)&&this.fireEvent(Data.EVENT_SAVEDATA_ERROR,n))},applyUpdates:function(e,t){this.disableRecordChange();try{var n=this.deleteDatas.get();n&&$.isArray(n)&&n.splice(0,n.length),this.eachAll(function(e){var t=e.row.row,n=t.userdata.recordState;if(this.updateMode=="whereVersion"&&Data.STATE.EDIT==n){var r=this.getVersionColumn();if(r&&t[r]){var i=parseInt(t[r].value.get(),10)+1;t[r].value.set(i)}}if(Data.STATE.EDIT==n||Data.STATE.NEW==n)for(var s in this.defCols)t[s].changed=0,t[s].originalValue=t[s].value.get();t.userdata.recordState=Data.STATE.NONE},this)}finally{this.enabledRecordChange()}},getVersionColumn:function(){return this.versionRelation},loadNextPageData:function(e){if(this.limit==-1)return;return e=e||{append:!0},this.isLoaded()?this._refreshData(e):this.refreshData(e)},loadAllPageData:function(e){e=e||{};if(this.limit==-1&&!this.isLoaded())return this.refreshData(e);var t=this.getTotal(e.parent),n=this.getOffset(e.parent);if(t<=n)return;if(t<1)return;var r=this.limit;try{return e.append=!0,e.limit=t,this._refreshData(e)}finally{this.limit=r}},loadPageData:function(e,t){return this.limit==-1||1==e?this.refreshData(t):(t=t||{},e=e<1?1:e,t.offset=(e-1)*this.limit,t.append=!1,this._refreshData(t))},refreshData:function(e){return e=e||{},this.definition.offset?e.offset=this.definition.offset:e.offset=0,e.append=e.append!==!0?!1:!0,this._refreshData(e)},_clsSlaveDatasState:function(){var e=this.slaveDatas;$.isArray(e)&&$.each(e,function(e,t){t._clear(),t._clsSlaveDatasState(),t.byMaster={}})},_confirm:function(e,t,n,r){r?confirm(e)?t&&t():n&&n():justep.Util.confirm(e,t,n)},_refreshData:function(e){var t=!1,n=!1,r=this.getCurrentRow(!0),i=r?this.getRowID(r):null,s={cancel:!1,options:e,source:this};this.fireEvent(Data.EVENT_REFRESHDATA_BEFORE,s);if(s.cancel)return!1;e=$.extend({},e);var o=function(){e&&"number"==typeof e.offset&&this.setOffset(e.offset,e.parent),e&&"number"==typeof e.limit&&(this.limit=e.limit);var r=this.getOffset(e?e.parent:null);e._sys_={oldRowID:i,offset:r};if(this.master&&this.master.masterData&&!e.append){this.byMaster={};var o=this.master.masterData,u=o.getCurrentRow(),a=o.getRowID(u);this.byMaster[a]={loaded:!0}}if(this.hasListener(Data.EVENT_REFRESHDATA))s={cancel:!1,limit:this.limit,offset:this.getOffset(e.parent),options:e,async:n,source:this},this.fireEvent(Data.EVENT_REFRESHDATA,s),n=s.async,t=!s.cancel;else{var f=this.doRefreshData(e);$.isPlainObject(f)?(t=f.success,n=f.async):t=f}n||this.doRefreshAfter(t,e)}.bind(this),u=this.confirmRefresh;return e&&undefined!==e.confirm&&(u=e.confirm),e&&e.append?o():this.isChanged()&&u?this._confirm(this.confirmRefreshText,o,null,!n):o(),t},doRefreshAfter:function(e,t,n){n=n||{},n.source||(n.source=this);if(!t){var r=this.getOffset(t?t.parent:null);t={_sys_:{offset:r}}}var i=t.onError,s=t.onSuccess,o;if(e){t.append||this._clsSlaveDatasState(),this._setLoaded(!0,t?t.parent:null);if(!t||!t.append){var u=t._sys_.oldRowID,a=u!==null?this.getRowByID(u):null;a?a&&this.to(a):this.first()}this.limit!=-1&&this.setOffset(t._sys_.offset+this.limit,t?t.parent:null),o={limit:this.limit,offset:this.getOffset(t?t.parent:null),options:t,source:this,success:e,changedSource:this,type:"refresh",selfChanged:!0},this.doDataChanged(o),s&&$.isFunction(s)&&s(n)}else i&&$.isFunction(i)&&i(n),this.hasListener(Data.EVENT_REFRESHDATA_ERROR)&&this.fireEvent(Data.EVENT_REFRESHDATA_ERROR,n);o={limit:this.limit,offset:this.getOffset(t?t.parent:null),options:t,source:this,success:e},this.fireEvent(Data.EVENT_REFRESHDATA_AFTER,o)},doRefreshData:function(options){return this.definition.initData&&this.loadData({rows:eval("("+this.definition.initData+")"),"@type":"table"}),!0},deleteAllData:function(){var e=this.datas.peek();if($.isArray(e)){e=e.slice(0);var t=this.deleteData(e),n={};return n.source=this,n.changedSource=this,n.type="clear",n.selfChanged=!0,this.doDataChanged(n),t}return!0},deleteData:function(e,t){var n=!1,r=t&&t.async||!1;e=e?e:[this.getCurrentRow(!0)],e instanceof Data.Row&&(e=[e]);var i={cancel:!1,source:this,option:t,options:t,deleteRows:e};this.fireEvent(Data.EVENT_DELETEDATA_BEFORE,i);if(i.cancel)return!1;var s=this.confirmDelete;t&&undefined!==t.confirm&&(s=t.confirm),t=$.extend({},t),t._sys_={rows:e};var o=function(){if(this.hasListener(Data.EVENT_DELETEDATA))i={cancel:!1,source:this,option:t,options:t,async:r,deleteRows:e},this.fireEvent(Data.EVENT_DELETEDATA,i),r=i.async,n=!i.cancel;else{var s=0,o,u;if(!this.directDeleteMode){r=!1;if(!e)return!1;for(s=e.length-1;s>=0;s--)o=e[s],Data.STATE.NEW!=this.getRowState(o)&&(this.setRowState(o,Data.STATE.DELETE),this.deleteDatas.push(o),u=this.getTotal(o.row.userdata.parent)-1,this.setTotal(u>=0?u:0,o.row.userdata.parent)),this.remove(o);n=!0}else{t=$.extend({},t);var a=t.onSuccess,f=this;t.onSuccess=function(t){for(s=0;s<e.length;s++){var n=e[s],r=f.getTotal(n.row.userdata.parent)-1;f.setTotal(r>=0?r:0,n.row.userdata.parent),f.remove(n)}"function"==typeof a&&a(t)};var l=this.doDirectDeleteData(e,t);$.isPlainObject(l)?(n=l.success,r=l.async):n=l}}r||this.doDeleteAfter(n,t)}.bind(this);return s?this._confirm(this.confirmDeleteText,o,null,!r):o(),n},doDeleteAfter:function(e,t,n){n=n||{},n.source||(n.source=this);var r=t.onError,i=t.onSuccess;e?i&&$.isFunction(i)&&i(n):(r&&$.isFunction(r)&&r(n),this.hasListener(Data.EVENT_DELETEDATA_ERROR)&&this.fireEvent(Data.EVENT_DELETEDATA_ERROR,n));var s={source:this,deleteRows:t._sys_.rows};this.fireEvent(Data.EVENT_DELETEDATA_AFTER,s),s.changedSource=this,s.type="delete",s.selfChanged=!0,this.doDataChanged(s)},doDirectDeleteData:function(e,t){return!0},_bindValue:function(e,t,n){$.isPlainObject(e.row[t])||(e.row[t]={changed:0,value:e.row[t],originalValue:null}),e.row[t].value=this.bindValueChange(e.row[t].value,{data:this,handler:this._doValueChange,caller:this,rowID:n,row:e,col:t})},_bindRule:function(e,t,n){var r=this.defCols[t];r.calculate&&(typeof r.calculate=="string"&&(r.calculate=new Expr(r.calculate)),r.calculate instanceof Expr&&(e.row[t].value=this.bindCalculate(e.row[t].value,r.calculate,{$model:this.getModel(),$data:this,$row:e,$rowID:n,$col:t}))),this.bindRules(e.row[t].value,r.rules,e.row.userdata.isModified,{$model:this.getModel(),$data:this,$row:e,$rowID:n,$col:t}),typeof r.readonly=="string"&&(r.readonly=new Expr(r.readonly)),this.bindReadonly(e.row[t].value,r.readonly,{$model:this.getModel(),$data:this,$row:e,$rowID:n,$col:t}),e.row[t].value.define={data:this,row:e,col:t,defCol:r}},add:function(e,t,n,r){e=e||{};var i;for(var s in this.defCols)i=this.defCols[s].type,i==="DateTime"?e[s]=dateTime2Val(e[s]):i==="Date"?e[s]=date2Val(e[s]):i==="Time"?e[s]=time2Val(e[s]):e[s]=e[s];this.master&&!e[this.master.relation]&&(e[this.master.relation]=this.master.masterData.getRowID(this.master.masterData.getCurrentRow(!0)));var o=e[this.idColumn];typeof o=="object"&&(o=o.value);var u=e;u.userdata||(u.userdata={}),t&&!Bind.isObservable(t.rows)&&(t.rows=Bind.observableArray()),u.userdata.parent=t;var a=u.userdata.recordState==Data.STATE.NEW||u.userdata.recordState==Data.STATE.EDIT;u.userdata.isModified=Bind.observable(a),a&&this.isModified.set(!0),u=new Row(this,u);for(s in this.defCols)this._bindValue(u,s,o);for(s in this.defCols)this._bindRule(u,s,o);return r||(t?t.rows.push(u):this.allDatas.push(u)),n||this.to(u),u},remove:function(e){e=e?e:this.getCurrentRow(!0);var t=e.row.userdata.parent,n=t?t.rows:this.allDatas,r=n.indexOf(e),i=n.get().length;if(r>=0&&r<i){var s=e===this.getCurrentRow(!0),o=t?t.rows:this.datas,u=Bind.utils.arrayIndexOf(o.get(),e);n.splice(r,1);if(s){var a=this.getCount();i=o.get().length,a<=0?this.to(null):u<i?this.to(o.get()[u]):u>=i&&i>0?this.to(o.get()[u-1]):this.to(t)}if(t&&o.get().length<=0&&this.isTree()){var f=this.getTreeOption();f.nodeKindRelation&&t&&t.val(f.nodeKindRelation,Data.NODE_KIND_LEAF)}}},_masterFilter:function(e,t){if(!this.master)return!0;var n=this.master.masterData;if(t){var r=t.ref(n.idColumn);if(Bind.isObservable(r))return e===r.get()}},_setTreeFilter:function(e){this.setFilter("_treeFilter_",e)},_aggregate:function(e,t,n,r){var i=r?this.allDatas.get():this.datas.get(),s=0,o=0,u=null,a=null,f=n&&typeof n=="function",l=typeof n=="object"?n:undefined;for(var c=0;c<i.length;c++){var h=this.master?i[c].ref(this.master.relation).get():null;if(!f&&l===undefined||f&&n({source:this,data:this,row:i[c]})||l!==undefined&&this._masterFilter(h,l)){o++;if(t){var p=this.defCols[t],d=this.convert(i[c].ref(t).get(),p.type);if(d===undefined||d===null||d instanceof Data.ErrorValue)continue;s+=d,a=a===null?d:a<d?d:a,u=u===null?d:u>d?d:u}}}if("count"===e)return o;if("avg"===e)return s/o;if("sum"===e)return s;if("min"===e)return u;if("max"===e)return a},Count:function(e){return this._aggregate("count",null,e)},countByAll:function(e){return this._aggregate("count",null,e,!0)},count:function(e){return this._aggregate("count",null,e)},Avg:function(e,t){return this._aggregate("avg",e,t)},avgByAll:function(e,t){return this._aggregate("avg",e,t,!0)},avg:function(e,t){return this._aggregate("avg",e,t)},Sum:function(e,t){return this._aggregate("sum",e,t)},sumByAll:function(e,t){return this._aggregate("sum",e,t,!0)},sum:function(e,t){return this._aggregate("sum",e,t)},Min:function(e,t){return this._aggregate("min",e,t)},minByAll:function(e,t){return this._aggregate("min",e,t,!0)},min:function(e,t){return this._aggregate("min",e,t)},Max:function(e,t){return this._aggregate("max",e,t)},maxByAll:function(e,t){return this._aggregate("max",e,t,!0)},max:function(e,t){return this._aggregate("max",e,t)},_row2Json:function(e,t,n){var r={};for(var i in this.defCols){var s=$.isArray(n)?$.inArray(i,n)>-1:!1;i!==this.idColumn&&!s&&(!t||t&&!this.isUICalculateCol(i))&&(r[i]=e.row[i])}return r.userdata=$.extend({},e.row.userdata),r.userdata.id=e.row[this.idColumn],delete r.userdata.parent,Bind.toJS(r)},_rows2Json:function(e,t,n){var r="",i="",s="";for(var o in this.defCols){var u=$.isArray(n)?$.inArray(o,n)>-1:!1;if(o!==this.idColumn&&!u&&(!t||t&&!this.isUICalculateCol(o))){var a=this.defCols[o];r+=""!==r?","+o:o,i+=""!==i?","+a.type:a.type,s+=""!==s?","+a.define:a.define}}return{"@type":"table",rows:e,userdata:{idColumnDefine:this.defCols[this.idColumn].define,idColumnName:this.idColumn,idColumnType:this.defCols[this.idColumn].type,model:this.dataModel,relationAlias:r,relationTypes:i,relations:s,updateMode:this.updateMode}}},toJson:function(e){var t=!1,n=!1,r=[];arguments.length==1&&typeof e=="object"?(t=e.onlyChanged,n=e.excludeCalculateCol,r=e.excludeCols||[]):(arguments.length>=1&&(t=arguments[0]),arguments.length>=2&&(n=arguments[1]));var i=[];this.eachAll(function(e){var s=e.row,o=s.row.userdata.recordState;(!t||Data.STATE.EDIT==o||Data.STATE.NEW==o||Data.STATE.DELETE==o)&&i.push(this._row2Json(s,n,r))},this);var s=this.deleteDatas.get();if(s.length>0){var o=s.length;for(var u=0;u<o;u++)i.push(this._row2Json(s[u],n,r))}return this._rows2Json(i,n,r)}});Data.Row=Row,Data.registerData=function(e,t,n){e instanceof Model&&(e[t]=n,e.registerComponent(t,n))},Data.unRegisterData=function(e,t){e instanceof Model&&(e.unRegisterComponent(t),delete e[t])},Data.$=function(e,t){return e instanceof Model?e.getComponent(t):null},Data.each=function(e,t){if(!e||!$.isFunction(t))return;for(var n in e){var r=e[n];if(r instanceof Data){var i={data:r,cancel:!1};t(i);if(i.cancel)return}}},Data.UUID=function(){return justep.UUID.createUUID()},Data.STATE={NEW:"new",DELETE:"delete",EDIT:"edit",NONE:"none"},Data.EVENT_CREATE="onCreate",Data.EVENT_CUSTOM_SORT="onCustomSort",Data.EVENT_VALUE_CHANGE="onValueChange",Data.EVENT_VALUE_CHANGED="onValueChanged",Data.EVENT_DATA_CHANGE="onDataChange",Data.EVENT_INDEX_CHANGED="onIndexChanged",Data.EVENT_INDEX_CHANGING="onIndexChanging",Data.EVENT_LOAD_SLAVEDATA="onLoadSlave",Data.EVENT_SLAVEDATAS_CHANGED="onSlaveDatasChanged",Data.EVENT_NEWDATA_ERROR="onNewError",Data.EVENT_NEWDATA_CREATEPARAM="onNewCreateParam",Data.EVENT_NEWDATA_BEFORE="onBeforeNew",Data.EVENT_NEWDATA="onCustomNew",Data.EVENT_NEWDATA_AFTER="onAfterNew",Data.EVENT_DELETEDATA_ERROR="onDeleteError",Data.EVENT_DELETEDATA_BEFORE="onBeforeDelete",Data.EVENT_DELETEDATA="onCustomDelete",Data.EVENT_DELETEDATA_AFTER="onAfterDelete",Data.EVENT_REFRESHDATA_ERROR="onRefreshError",Data.EVENT_REFRESHDATA_CREATEPARAM="onRefreshCreateParam",Data.EVENT_REFRESHDATA_BEFORE="onBeforeRefresh",Data.EVENT_REFRESHDATA="onCustomRefresh",Data.EVENT_REFRESHDATA_AFTER="onAfterRefresh",Data.EVENT_SAVEDATA_ERROR="onSaveError",Data.EVENT_SAVEDATA_CREATEPARAM="onSaveCreateParam",Data.EVENT_SAVEDATA_BEFORE="onBeforeSave",Data.EVENT_SAVEDATA="onCustomSave",Data.EVENT_SAVEDATA_AFTER="onAfterSave",Data.EVENT_SAVE_COMMIT="onSaveCommit",Data.LOAD_TREE_ROOT="___tree___root___",Data.NODE_KIND_LEAF="nkLeaf";var date2String=function(){return justep.Date.toString(this,"yyyy-MM-dd")},dateTime2String=function(){return justep.Date.toString(this,"yyyy-MM-dd hh:mm:ss")};return Data.convert=function(e,t){var n=Data.createErrorValue(e);return-1<$.inArray(t,["Integer","Long"])&&typeof e=="string"?e=justep.String.toInt(e,n):-1<$.inArray(t,["Double","Float","Decimal"])&&typeof e=="string"?e=justep.String.toFloat(e,n):t=="Date"&&typeof e=="string"&&e?(e=justep.Date.fromString(e,"yyyy-MM-dd"),e?e.toString=date2String:e=n):t=="DateTime"&&typeof e=="string"&&e&&(e=justep.Date.fromString(e,"yyyy-MM-ddThh:mm:ss.fff"),e?e.toString=dateTime2String:e=n),e},Data.ErrorValue=justep.Object.extend({constructor:function(e){this.value=e},toString:function(){return NaN}}),Data.createErrorValue=function(e){var t=new Data.ErrorValue(e);return t},Data.NullValue=justep.BindComponent.NullValue,Data.Rules=Rules,justep.Component.addOperations(Data,{save:{label:justep.Message.getMessage(justep.Message.JUSTEP231003),icon:"glyphicon glyphicon-floppy-disk",init:function(){var e=this,t=this.owner,n=function(){e.setEnable(!t.getReadonly()&&t.isChanged())};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_SAVE_COMMIT,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n)},method:function(e){return this.owner.saveData()}},"delete":{label:justep.Message.getMessage(justep.Message.JUSTEP231005),icon:"icon-minus",init:function(){var e=this,t=this.owner,n=function(){setTimeout(function(){e.setEnable(!t.getReadonly()&&t.getCount()>0&&!!t.getCurrentRow(!0))},1)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},argsDef:[{name:"rows",displayName:justep.Message.getMessage(justep.Message.JUSTEP231083)}],method:function(e){return this.owner.deleteData(e.rows,{async:!0})}},"new":{label:justep.Message.getMessage(justep.Message.JUSTEP231006),icon:"icon-plus",init:function(){var e=this,t=this.owner,n=function(){setTimeout(function(){e.setEnable(!t.getReadonly())},1)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n)},argsDef:[{name:"defaultValues",displayName:justep.Message.getMessage(justep.Message.JUSTEP231084)},{name:"index",displayName:justep.Message.getMessage(justep.Message.JUSTEP231096)}],method:function(e){return this.owner.newData(e)}},newChild:{label:justep.Message.getMessage(justep.Message.JUSTEP231008),icon:"icon-plus",init:function(){var e=this,t=this.owner,n=function(){setTimeout(function(){e.setEnable(t.isTree()&&!t.getReadonly()&&!!t.getCurrentRow(!0))},1)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n)},argsDef:[{name:"defaultValues",displayName:justep.Message.getMessage(justep.Message.JUSTEP231084)}],method:function(e){return e.parent=this.owner.getCurrentRow(!0),this.owner.newData(e)}},newBrother:{label:justep.Message.getMessage(justep.Message.JUSTEP231009),icon:"icon-plus",init:function(){var e=this,t=this.owner,n=function(){setTimeout(function(){e.setEnable(t.isTree()&&!t.getReadonly()&&!!t.getCurrentRow(!0))},1)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n)},argsDef:[{name:"defaultValues",displayName:justep.Message.getMessage(justep.Message.JUSTEP231084)}],method:function(e){var t=this.owner.getCurrentRow(!0);return t&&(e.parent=t.parent()),this.owner.newData(e)}},refresh:{label:justep.Message.getMessage(justep.Message.JUSTEP231007),icon:"icon-refresh",method:function(e){return this.owner.refreshData({async:!0})}},firstRow:{label:justep.Message.getMessage(justep.Message.JUSTEP231086),icon:"icon-chevron-left",init:function(){var e=this,t=this.owner,n=function(){var n=t.getCount();e.setEnable(n>1&&t.getFirstRow()!==t.getCurrentRow(!0))};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(){return this.owner.first()}},prevRow:{label:justep.Message.getMessage(justep.Message.JUSTEP231010),icon:"icon-chevron-left",init:function(){var e=this,t=this.owner,n=function(){var n=t.getCount();e.setEnable(n>1&&t.getFirstRow()!==t.getCurrentRow(!0))};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(){return this.owner.pre()}},nextRow:{label:justep.Message.getMessage(justep.Message.JUSTEP231011),icon:"icon-chevron-right",init:function(){var e=this,t=this.owner,n=function(){var n=t.getCount();e.setEnable(n>1&&t.getLastRow()!==t.getCurrentRow(!0))};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(){return this.owner.next()}},lastRow:{label:justep.Message.getMessage(justep.Message.JUSTEP231087),icon:"icon-chevron-right",init:function(){var e=this,t=this.owner,n=function(){var n=t.getCount();e.setEnable(n>1&&t.getLastRow()!==t.getCurrentRow(!0))};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_INDEX_CHANGED,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(){return this.owner.last()}},loadPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231097),icon:"",argsDef:[{name:"pageIndex",displayName:justep.Message.getMessage(justep.Message.JUSTEP231061)}],method:function(e){var t=this.owner,n=isNaN(e.pagrIndex)||"number"!=typeof e.pagrIndex?1:e.pagrIndex;return t.loadPageData(n,{async:!0})}},firstPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231064),icon:"icon-chevron-left",init:function(){var e=this,t=this.owner,n=function(){e.setEnable(t.limit!=-1&&t.getOffset()>t.limit)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(e){return this.owner.loadPageData(1,{async:!0})}},prevPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231015),icon:"icon-chevron-left",init:function(){var e=this,t=this.owner,n=function(){e.setEnable(t.limit!=-1&&t.getOffset()>t.limit)};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(e){var t=this.owner,n=t.getOffset()/t.limit-1;return t.loadPageData(n,{async:!0})}},nextPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231014),icon:"icon-chevron-right",init:function(){var e=this,t=this.owner,n=function(){e.setEnable(t.limit!=-1&&t.getOffset()<=t.getTotal())};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(e){var t=this.owner,n=t.getOffset()/t.limit+1;return t.loadPageData(n,{async:!0})}},lastPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231065),icon:"icon-chevron-right",init:function(){var e=this,t=this.owner,n=function(){e.setEnable(t.limit!=-1&&t.getOffset()<=t.getTotal())};this.owner.on(Data.EVENT_DATA_CHANGE,n),this.owner.on(Data.EVENT_SLAVEDATAS_CHANGED,n)},method:function(e){var t=this.owner,n=t.getTotal()%t.limit,r=Math.round(t.getTotal()/t.limit-.5)+(n===0?0:1);return t.loadPageData(r,{async:!0})}},loadNextPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231012),icon:"icon-chevron-right",method:function(){return this.owner.loadNextPageData({async:!0})}},loadAllPage:{label:justep.Message.getMessage(justep.Message.JUSTEP231013),icon:"icon-chevron-right",method:function(){return this.owner.loadAllPageData({async:!0})}}}),Data.getColDef=function(e){if(e&&e.define){var t=e.define;return t.defCol}},Data.ExtendType=ExtendType,Data.registerExtendType=ExtendType.registerExtendType,Data.unregisterExtendType=ExtendType.unregisterExtendType,Data.getEditor=ExtendType.getEditor,Data.getExtendTypeClass=ExtendType.getExtendTypeClass,Data.getExtendTypeObject=ExtendType.getExtendTypeObject,Data}),define("$model/UI2/system/components/justep/model/model.config",["require"],function(e){return{properties:{},events:["onModelConstruct","onModelConstructing","onModelConstructDone","onLoad","onLoaded","onunLoad","onActive","onInactive"],binds:{}}}),define("$model/UI2/system/components/justep/model/model",["require","jquery","$UI/system/lib/justep","./model.config","$UI/system/resources/system.res"],function(e){var t=e("jquery"),n=e("$UI/system/lib/justep"),r=e.normalizeName("./model"),i=e("./model.config");e("$UI/system/resources/system.res");var s=n.ViewComponent.extend({buildTemplate:function(e){var t=new n.Message(n.Message.JUSTEP230073,r);throw n.Error.create(t)},getConfig:function(){return i},init:function(e,t){this.callParent(e,t),this.getModel().on(n.ModelBase.MODEL_CONSTRUCT_EVENT,this._fireEvent.bind(this,n.ModelBase.MODEL_CONSTRUCT_EVENT)),this.getModel().on(n.ModelBase.MODEL_CONSTRUCT_DONE_EVENT,this._fireEvent.bind(this,n.ModelBase.MODEL_CONSTRUCT_DONE_EVENT)),this.getModel().on(n.ModelBase.LOAD_EVENT,this._fireEvent.bind(this,n.ModelBase.LOAD_EVENT)),this.getModel().on(n.ModelBase.LOADED_EVENT,this._fireEvent.bind(this,n.ModelBase.LOADED_EVENT)),this.getModel().on(n.ModelBase.UNLOAD_EVENT,this._fireEvent.bind(this,n.ModelBase.UNLOAD_EVENT)),this.getModel().on(n.ModelBase.ACTIVE_EVENT,this._fireEvent.bind(this,n.ModelBase.ACTIVE_EVENT)),this.getModel().on(n.ModelBase.INACTIVE_EVENT,this._fireEvent.bind(this,n.ModelBase.INACTIVE_EVENT))},_fireEvent:function(e){this.fireEvent(e,{source:this})}});return n.Component.register(r,s),s}),define("$model/UI2/system/components/justep/window/window",["require","jquery","$UI/system/lib/justep","$UI/system/resources/system.res"],function(e){function c(e,t,n){var r=e.message||"",i=r.indexOf(t),s=r.indexOf(n);return i!=-1&&s!=-1&&s>i?r.substr(i+t.length,s-(i+t.length)):null}function h(e){return c(e,n.Error.CLIENT_ERROR_START,n.Error.CLIENT_ERROR_END)}function p(e){return c(e,n.Error.SERVER_ERROR_START,n.Error.SERVER_ERROR_END)}function d(){var e="__justepErrorDialog__",n=t("#"+e)[0];if(!n){var r="	<div class='modal' style='z-index:30000' id='"+e+"'>"+"		<div class='modal-dialog'>"+"			<div class='modal-content'>"+"				<div class='modal-header'>"+"					<h4>"+i+"</h4>"+"				</div>"+"				<div class='modal-body' style='overflow:auto;max-height:400px'>"+"					<div class='x-error-message'><span style='word-wrap: break-word;word-break: break-all;' class='x-error-message-body'/></div>"+"					<div class='x-error-code'><span style='font-weight:bold'>"+o+"</span><span class='x-error-code-body'/></div>"+"					<div class='x-error-reason'><span style='font-weight:bold'>"+u+"</span><span class='x-error-reason-body'/></div>"+"					<div><a  class='x-error-show-detail'>"+a+"</a></div>"+"					<div class='x-error-stack' style='word-wrap: break-word;'/>"+"				</div>"+"				<div class='modal-footer'>"+"					<button type='button' class='btn btn-default x-error-close'>"+l+"</button>"+"				</div>"+"			<div>"+"		</div>"+"	</div>",s=t(r);t("#applicationHost").append(s),(!window.__justep||!window.__justep.isDebug)&&t(".x-error-show-detail").hide(),s.find(".x-error-close").on("click",function(){s.hide()}),s.find(".x-error-show-detail").on("click",function(){var e=s.find(".x-error-show-detail");e.hasClass("x-error-show")?(e.removeClass("x-error-show"),e.text(a),s.find(".x-error-stack").hide()):(e.text(f),e.addClass("x-error-show"),s.find(".x-error-stack").show())}),this.domNode=s[0],this.$domNode=s}}function v(e){var t=e.message||"";try{return JSON.parse(t)}catch(n){return null}}var t=e("jquery"),n=e("$UI/system/lib/justep"),r=e.normalizeName("./window");e("$UI/system/resources/system.res");var i=(new n.Message(n.Message.JUSTEP230101)).getMessage(),s=(new n.Message(n.Message.JUSTEP230091)).getMessage(),o=(new n.Message(n.Message.JUSTEP230092)).getMessage(),u=(new n.Message(n.Message.JUSTEP230093)).getMessage(),a=(new n.Message(n.Message.JUSTEP230094)).getMessage(),f=(new n.Message(n.Message.JUSTEP230095)).getMessage(),l=(new n.Message(n.Message.JUSTEP230096)).getMessage();d.prototype.open=function(e){var t=e.server||e.client;this.$domNode.find(".x-error-message-body").text(t.message||""),t.code?(this.$domNode.find(".x-error-code").show(),this.$domNode.find(".x-error-code-body").text(t.code)):this.$domNode.find(".x-error-code").hide(),t.reason?(this.$domNode.find(".x-error-reason").show(),this.$domNode.find(".x-error-reason-body").text(t.code)):this.$domNode.find(".x-error-reason").hide(),this.$domNode.find(".x-error-show-detail").text(a).removeClass("x-error-show"),this.$domNode.find(".x-error-stack").text(t.stack||"").hide(),this.$domNode.show()},window.onerror=function(){if(arguments.length>2&&arguments[2]===55&&arguments[0]==="TypeError: null is not an object (evaluating 'a.childNodes')")return;var e=null;for(var t=0;t<arguments.length;t++)if(arguments[t]instanceof Error){e=arguments[t];break}if(!e){var r=arguments[0]||"",i=r.indexOf(":");i!=-1&&(r=r.substr(i+1)),e={message:r}}var s={};if(e){var o=v(e);if(o)s.server=o;else{var u=p(e);u?(s.server=JSON.parse(u),s.client={},s.client.message=(e.message||"").replace(n.Error.SERVER_ERROR_START,"").replace(n.Error.SERVER_ERROR_END,""),s.client.stack=(e.stack||"").replace(n.Error.SERVER_ERROR_START,"").replace(n.Error.SERVER_ERROR_END,"")):(u=h(e),u?(s.client=JSON.parse(u),s.client.stack||(s.client.stack=e.stack||""),s.client.stack=s.client.stack.replace(n.Error.CLIENT_ERROR_START,"").replace(n.Error.CLIENT_ERROR_END,"")):(s.client={},s.client.message=e.message,s.client.stack=e.stack))}}else s.client={},s.client.message=arguments[0];return window.errorDialog||(window.errorDialog=new d),window.errorDialog.open(s),!1};var m=n.ViewComponent.extend({getConfig:function(){return{}},constructor:function(e){this.callParent(e)}});return n.Component.addOperations(m,{close:{label:n.Message.getMessage(n.Message.JUSTEP230096),icon:"icon-chevron-left",method:function(e){n.Portal.closeWindow()}}}),n.Component.register(r,m),m});