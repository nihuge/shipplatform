<extend name="Public:base"/>
<block name="title">船舱管理</block>
<block name="navtitle">
    <li class="active">
        船舱管理
    </li>
    <li class="active">
        船舱修改
    </li>
</block>
<block name="active7">class="active"</block>
<block name="content">
    <div class="page-container">
        <form action="__ACTION__" method="post">
            <div style='width:800px;margin:auto auto;'>
                所属船：
                <select style="width: 200px;" name="shipid" required id='shipid'>
                    <option value="">----&nbsp;选&nbsp;择&nbsp;船&nbsp;舶&nbsp;----</option>
                    <volist name="shiplist" id="v">
                        <option value="{$v['id']}" NUMBER="{$v['cabinnum']}" SUANFA="{$v['suanfa']}">{$v['shipname']}
                        </option>
                    </volist>
                </select>
                <span style="margin-left: 40px;color: red;">基准高度支持输入4位整数或小数，并且会检查数据</span>
            </div>
            <br>
            <div style="text-align: right">
                <input style="left: 10px;width: 18px;height: 18px;" type="checkbox" id="no_check" name="jizhu" title="记住密码" lay-skin="primary"><label for="no_check" style="font-size: 17px;margin-right: 150px;color: #a03e00">勾选时不提示数据</label>
<!--                <input type="checkbox" id="no_check" style="border-radius: 50%;width: 16px;height: 16px;"/>-->
            </div>
            <table id="sample-table-1" class="table table-striped table-bordered table-hover"
                   style='width:800px;margin:auto auto;text-align: center;'>
                <tr>
                    <td rowspan="2">舱名</td>
                    <td colspan="2">基准高度(H)</td>
                    <td colspan="2">底量(D)</td>
                    <td rowspan="2">管线容量</td>
                </tr>
                <tr>
                    <td>容量表</td>
                    <td>底量表</td>
                    <td>容量表</td>
                    <td>底量表</td>
                </tr>
            </table>
        </form>
    </div>
    <script type="text/javascript">
        var checksign = true;

        //下拉获取cang,单选获取表
        $("select[name=shipid]").change(function () {
            var edc = $("#sample-table-1");
            var string = '<tr><td rowspan="2">舱名</td><td colspan="2">基准高度(H)</td><td colspan="2">底量(D)</td><td rowspan="2">管线容量</td></tr><tr><td>容量表</td><td>底量表</td><td>容量表</td><td>底量表</td></tr>';
            if ($(this).children().is(':selected')) {
                var id = $(this).val();

                if (id !== '') {
                    var num = $('#shipid option:selected').attr('NUMBER');
                    var suanfa = $('#shipid option:selected').attr('SUANFA');
                    console.log(num);
                    if (suanfa == 'c') {
                        for (var i = 1; i <= num; i++) {
                            // pipe_line
                            string += '<tr><td><input type="text" id="form-field-1" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][cabinname]" maxlength="5" tabindex="' + (num * 0 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][altitudeheight]" maxlength="5" tabindex="' + (num * 1 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" value="" name="data[' + i + '][dialtitudeheight]" maxlength="5" tabindex="' + (num * 2 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][bottom_volume]" maxlength="5" tabindex="' + (num * 3 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" value="" name="data[' + i + '][bottom_volume_di]" maxlength="5" tabindex="' + (num * 4 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][pipe_line]" maxlength="5" tabindex="' + (num * 5 + i) + '"/></td></tr>';
                        }
                    } else {
                        for (var i = 1; i <= num; i++) {
                            // pipe_line
                            string += '<tr><td><input type="text" id="form-field-1" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][cabinname]" maxlength="5" tabindex="' + (num * 0 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][altitudeheight]" maxlength="5" tabindex="' + (num * 1 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" value="" name="data[' + i + '][dialtitudeheight]" maxlength="5" tabindex="' + (num * 2 + i) + '" disabled="disabled"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][bottom_volume]" maxlength="5" tabindex="' + (num * 3 + i) + '"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" value="" name="data[' + i + '][bottom_volume_di]" maxlength="5" tabindex="' + (num * 4 + i) + '" disabled="disabled"/></td><td><input type="text" id="form-field-2" class="col-xs-15 col-sm-12" required value="" name="data[' + i + '][pipe_line]" maxlength="5" tabindex="' + (num * 5 + i) + '"/></td></tr>';
                        }
                    }
                    string += '<tr><td colspan=6 style="text-align: center;"><input type="submit" name="sub" value="提交" class="btn btn-primary" ></td></tr>';
                }
                edc.html(string);

            } else {
                edc.html(string);
            }

            // var hasFocus = $('input[type=text]').is(':focus');

            var inputs = $('input[id=form-field-2]');
            // console.log(inputs.val());

            inputs.on("blur", function () {
                var tmptxt = $(this).val();
                if (tmptxt !== "") {
                    if (tmptxt.indexOf(".") == -1) {
                        var number = parseInt(tmptxt);
                        if (number >= 1000) {
                            $(this).val(number / 1000);
                        } else {
                            if (checksign) {
                                layer.tips('此数值有些问题，请检查', $(this), {
                                    tips: [2, '#3595CC'],
                                    time: 4000,
                                    tipsMore:true
                                });
                            }
                        }
                    }
                }
                // alert("整数");
            });
        });

        $('#no_check').change(function () {
            var choice = $(this)[0].checked;

            if (choice === false) {
                checksign = true;
            } else {
                checksign = false;
            }

            console.log(checksign);
        });

    </script>
</block>