<extend name="Public:base" />
<block name="title">公司管理</block>
<block name="navtitle">
    <li class="active">
        公司管理
    </li>
    <li class="active">
        修改公司
    </li>
</block>
<block name="active4">class="active"</block>
<block name="content">
	<div class="page-container">
		<table id="sample-table-1" class="table table-striped table-bordered table-hover" style='width:500px;margin:auto auto;text-align: center;'>
            <form action="__ACTION__" method="post">
            <input type="hidden" name="id" value="{$data['id']}" >
            <tr>
                <td>公司LOGO</td>
                <td>
                    <img class="normalFace" src="{:($data['logo'] == '') ? '__PUBLIC__/Admin/profile-pic.jpg' : $data['logo']}" onclick="fileSelect();" style='width: 100px;height: 110px;'>
                    <input type="file" name="photo" id="photo" value="{:($data['logo'] == '') ? '__PUBLIC__/Admin/profile-pic.jpg' : $data['logo']}" class="filepath" style="display:none;">
                    <input type="text" name="logo" id="logo" value="{:($data['logo'] == '') ? '__PUBLIC__/Admin/profile-pic.jpg' : $data['logo']}" style="display:none;">
                </td>
            </tr>
            <tr>
                <td>报表模板名称</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="pdf" maxlength="20" value="{$data['pdf']}"/>
                </td>
            </tr>
            <tr>
                <td>公司名称</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="firmname" required maxlength="30" value="{$data['firmname']}"/>
                </td>
            </tr>
            <tr>
                <td>公司类型</td>
                <td>
                    <select class=" col-xs-10 col-sm-8" id="form-field-select-1" name="firmtype">
                        <option value="1" {$data['firmtype']=='1' ? 'selected' : ''}>检验公司</option>
                        <option value="2" {$data['firmtype']=='2' ? 'selected' : ''}>船舶公司</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>社会信用代码</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="shehuicode" value="{$data['shehuicode']}" required maxlength="50" />
                </td>
            </tr>
            <tr>
                <td>社会信用代码图片</td>
                <td>
                    <img class="normalFace" src="{:($data['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['img']}" onclick="fileSelect1();" style='width: 150px;height: 110px;'>
                    <input type="file" name="photo1" id="photo1" value="{:($data['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['img']}" class="filepath1" style="display:none;">
                    <input type="text" name="img" id="img" value="{:($data['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['img']}" style="display:none;">
                </td>
            </tr>
            <tr>
                <td>公司地址</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="location" required maxlength="45"  value="{$data['location']}"/>
                </td>
            </tr>
            <tr>
                <td>公司简介</td>
                <td style="text-align: left;">
                    <textarea name="content" id="" cols="25" rows="10" required maxlength="500" >{$data['content']}</textarea>
                </td>
            </tr>
            <tr>
                <td>联&nbsp;系&nbsp;&nbsp;人</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="people" maxlength="10" value="{$data['people']}"/>
                </td>
            </tr>
            <tr>
                <td>联系电话</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="phone"  maxlength="16" value="{$data['phone']}"/>
                </td>
            </tr>
            <tr>
                <td>合同编号</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="number" maxlength="48"  required value="{$data['number']}" />
                </td>
            </tr>
            <tr>
                <td>到期时间</td>
                <td>
                    <!-- <input class="col-xs-10 col-sm-8" id="test1" name="expire_time" required> -->
                    <input class="col-xs-10 col-sm-8" id="test1" name="expire_time" required value="{$data['expire_time']|date='Y-m-d',###}">
                </td>
            </tr>
            <tr>
                <td>收费模式</td>
                <td>
                    <select class=" col-xs-10 col-sm-8" id="form-field-select-1" name="membertype" required>
                        <option value="1" {$data['membertype']=='1' ? 'selected' : ''}>会员费</option>
                        <option value="2" {$data['membertype']=='2' ? 'selected' : ''}>服务费</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>服务费标准</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="service" maxlength="4" value="{$data['service']}" required/>
                </td>
            </tr>
            <tr>
                <td>账户余额</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="balance" maxlength="11" value="{$data['balance']}" readonly/>
                </td>
            </tr>            
            <tr>
                <td>信用额度</td>
                    <td>
                        <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="creditline" maxlength="8" value="{$data['creditline']}" required/>
                    </td>
                </tr>
            <tr>
                <td>船舶限制</td>
                <td>
                    <input type="text" id="form-field-1" class="col-xs-10 col-sm-8" name="limit" maxlength="5" value="{$data['limit']}" required/>
                </td>
            </tr>
            <tr>
                <td>公司图片</td>
                <td>
                    <img class="normalFace" src="{:($data['image'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['image']}" onclick="fileSelect2();" style='width: 150px;height: 110px;'>
                    <input type="file" name="photo2" id="photo2" value="{:($data['image'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['image']}" class="filepath2" style="display:none;">
                    <input type="text" name="image" id="image" value="{:($data['image'] == '') ? '__PUBLIC__/Admin/noimg.png' : $data['image']}" style="display:none;">
                </td>
            </tr>
            <tr>
                <td colspan=2 style="text-align: center;">
                    <input type="submit" name="sub" value="提交" class="btn btn-primary" >
                </td>
            </tr>
            </form>
		</table>
	</div>
    <script src="__ADMIN_STATIC__/ajaximg/jquery.min.js"></script>
    <script src="__ADMIN_STATIC__/ajaximg/lrz.all.bundle.js"></script>
    <script type="text/javascript">
    laydate.render({
        elem: '#test1' //指定元素
        ,theme: 'grid' //主题
        ,format: 'yyyy-MM-dd' //自定义格式
        ,min: 0
    });
    </script>
    <script type="text/javascript">
        function checkImg(img_id){
            // var img_id=document.getElementById('movie_img').value; //根据id得到值
            var index= img_id.indexOf("."); //得到"."在第几位
            img_id=img_id.substring(index); //截断"."之前的，得到后缀
            if(img_id!=".bmp"&&img_id!=".png"&&img_id!=".gif"&&img_id!=".jpg"&&img_id!=".jpeg"){  //根据后缀，判断是否符合图片格式
                  // alert("不是指定图片格式,重新选择"); 
                  return '2';
                 // document.getElementById('movie_img').value="";  // 不符合，就清除，重新选择
              }
         }
        //点击绑定
        function fileSelect() {
            document.getElementById("photo").click();
        }
        //图片生成并展示
        $(function() {
            $(document).on('change', '.filepath', function(e) {
                var str = $(this).attr("name");
                var str1 = $(this).val();
                var res = checkImg(str1);
                if (res == '2') {
                    alert("不是指定图片格式,重新选择"); 
                    return false;
                }
                lrz(this.files[0], { width: 640, quality: 0.92 })
                    .then(function(rst) {
                        $.ajax({
                            url: "{:U('Firm/upload_ajax')}",
                            type: 'post',
                            data: { image: rst.base64, zd: str },
                            dataType: 'json',
                            enctype: 'multipart/form-data',
                            success: function(data) {
                                var obj = eval("(" + data + ")");
                                if (0 == obj.status) {
                                    return false;
                                } else {
                                    $(".normalFace").css('padding-top', '0px');
                                    var src = obj.url;
                                    $("input[name=" + str + "]").parent().children("img").attr("src", src);
                                    $("input[name='logo']").val(src);
                                    // alert(src);
                                }
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) { //上传失败 
                                alert(XMLHttpRequest.status);
                                alert(XMLHttpRequest.readyState);
                                alert(textStatus);
                            }
                        });
                    })
                    .catch(function(err) {

                    })
                    .always(function() {

                    });
            });
        });

        //点击绑定
        function fileSelect1() {
            document.getElementById("photo1").click();
        }
        //图片生成并展示
        $(function() {
            $(document).on('change', '.filepath1', function(e) {
                var str = $(this).attr("name");
                var str1 = $(this).val();
                var res = checkImg(str1);
                if (res == '2') {
                    alert("不是指定图片格式,重新选择"); 
                    return false;
                }
                lrz(this.files[0], { width: 640, quality: 0.92 })
                    .then(function(rst) {
                        $.ajax({
                            url: "{:U('Firm/upload_ajax')}",
                            type: 'post',
                            data: { image: rst.base64, zd: str },
                            dataType: 'json',
                            enctype: 'multipart/form-data',
                            success: function(data) {
                                var obj = eval("(" + data + ")");
                                if (0 == obj.status) {
                                    return false;
                                } else {
                                    $(".normalFace").css('padding-top', '0px');
                                    var src = obj.url;
                                    $("input[name=" + str + "]").parent().children("img").attr("src", src);
                                    $("input[name='img']").val(src);
                                    // alert(src);
                                }
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) { //上传失败 
                                alert(XMLHttpRequest.status);
                                alert(XMLHttpRequest.readyState);
                                alert(textStatus);
                            }
                        });
                    })
                    .catch(function(err) {

                    })
                    .always(function() {

                    });
            });
        });

        //点击绑定
        function fileSelect2() {
            document.getElementById("photo2").click();
        }
        //图片生成并展示
        $(function() {
            $(document).on('change', '.filepath2', function(e) {
                var str = $(this).attr("name");
                var str1 = $(this).val();
                var res = checkImg(str1);
                if (res == '2') {
                    alert("不是指定图片格式,重新选择"); 
                    return false;
                }
                lrz(this.files[0], { width: 640, quality: 0.92 })
                    .then(function(rst) {
                        $.ajax({
                            url: "{:U('Firm/upload_ajax')}",
                            type: 'post',
                            data: { image: rst.base64, zd: str },
                            dataType: 'json',
                            enctype: 'multipart/form-data',
                            success: function(data) {
                                console.log(data);
                                var obj = eval("(" + data + ")");
                                if (0 == obj.status) {
                                    return false;
                                } else {
                                    $(".normalFace").css('padding-top', '0px');
                                    var src = obj.url;
                                    $("input[name=" + str + "]").parent().children("img").attr("src", src);
                                    $("input[name='image']").val(src);
                                    // alert(src);
                                }
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) { //上传失败 
                                alert(XMLHttpRequest.status);
                                alert(XMLHttpRequest.readyState);
                                alert(textStatus);
                            }
                        });
                    })
                    .catch(function(err) {

                    })
                    .always(function() {

                    });
            });
        });
    </script>
</block>