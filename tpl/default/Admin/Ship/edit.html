<extend name="Public:base"/>
<block name="title">船管理</block>
<block name="navtitle">
    <li class="active">
        船舶管理
    </li>
    <li class="active">
        油船管理
    </li>
</block>
<block name="activeopen21">class="active open"</block>
<block name="active6">class="active"</block>
<block name="content">
    <style>
        .wid{width: 250px;}
        .kedu{
            width: 50px;margin-right: 10px;margin-top: 5px;
        }
    </style>
    <div class="page-container">
        <table id="sample-table-1" class="table table-striped table-bordered table-hover" style='width:900px;margin:auto auto;text-align: center;'>
            <form action="__ACTION__" method="post">
            <tr>
                <td>船舶图片</td>
                <td>
                    <img class="normalFace" src="{:($shipmsg['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $shipmsg['img']}" onclick="fileSelect1();" style='width: 150px;height: 110px;'>
                    <input type="file" name="photo1" id="photo1" value="{:($shipmsg['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $shipmsg['img']}" class="filepath1" style="display:none;">
                    <input type="text" name="img" id="img" value="{:($shipmsg['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $shipmsg['img']}" style="display:none;">
                </td>
            </tr>
            <input type="hidden" name="id" value="{$shipmsg['id']}">
            <tr>
                <td style="width:150px;">船名</td>
                <td>
                    <input type="text" class="wid" required name="shipname"  maxlength="15" value="{$shipmsg['shipname']}"/>
                </td>
            </tr>
            <tr>
                <td>所属公司</td>
                <td>
                    <select class="wid" name="firmid" id="firmid" required>
                        <volist name="firmlist" id="v">
                            <option value="{$v['id']}" {$v['id'] == $shipmsg['firmid'] ? 'selected' : ''}>{$v['firmname']}</option>
                        </volist>
                    </select>
                </td>
            </tr>
            <tr>
                <td>舱材料膨胀倍数</td>
                <td>
                    <input type="text" class="wid" required name="coefficient"  maxlength="15" value="{$shipmsg['coefficient']}"/>
                </td>
            </tr>
            <tr>
                <td>舱总数</td>
                <td>
                    <input type="text" class="wid" required name="cabinnum" maxlength="2" value="{$shipmsg['cabinnum']}"/>
                </td>
            </tr>
            <tr>
                <td>编号</td>
                <td>
                    <input type="text" class="wid" required  name="number" maxlength="50"  value="{$shipmsg['number']}"/>
                </td>
            </tr>
            <tr>
                <td>舱容到期时间</td>
                <td>
                    <input class="wid" id="test1" name="expire_time" required value="{$shipmsg['expire_time']|date='Y-m-d',###}">
                </td>
            </tr>
            <tr>
                <td>算法</td>
                <td>
                    <!-- <input type="text" class="wid" required  name="suanfa" maxlength="15" value="{$shipmsg['suanfa']}"/> -->

                    <select class="wid" name="suanfa" required>
                        <option value="a" {$shipmsg['suanfa'] == "a" ? 'selected' : ''}>a</option>
                        <option value="b" {$shipmsg['suanfa'] == 'b' ? 'selected' : ''}>b</option>
                        <option value="c" {$shipmsg['suanfa'] == 'c' ? 'selected' : ''}>c</option>
                        <option value="d" {$shipmsg['suanfa'] == 'd' ? 'selected' : ''}>d</option>
                    </select>
                    <span style="color:red"><br>a:一本书(容量表)；b:一本书(容量表与纵倾修正表)；c:两本书两个表(容量书与底量书,纵倾修正表和容量表)；d：两本书一个表(容量表)</span>
                </td>
            </tr>
            <tr>
                <td>管线容量</td>
                <td>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label>
                        <input name="is_guanxian" type="radio" class="ace" value="1"
                        {$shipmsg['is_guanxian'] == '1' ? 'checked' : ''}
                        />
                        <span class="lbl"> 已包含 </span>
                    </label>
                    &nbsp;&nbsp;
                    <label>
                        <input name="is_guanxian" type="radio" class="ace" value="2"
                        {$shipmsg['is_guanxian'] == '2' ? 'checked' : ''}
                        />
                        <span class="lbl"> 未包含 </span>
                    </label>
                </td>
            </tr>
            <tr>
                <td>货名</td>
                <td>
                    <input type="text" class="wid" required  name="goodsname" value="{$shipmsg['goodsname']}" maxlength="15" />
                </td>
            </tr>
            <tr>
                <td>识别号</td>
                <td>
                    <input type="text" class="wid"  name="shibie_num" value="{$shipmsg['shibie_num']}" maxlength="20" />
                </td>
            </tr>
            <tr>
                <td>制造单位</td>
                <td>
                    <input type="text" class="wid"  name="make" value="{$shipmsg['make']}" maxlength="25" />
                </td>
            </tr>
            <tr>
                <td>类型</td>
                <td>
                    <input type="text" class="wid"  name="type" value="{$shipmsg['type']}" maxlength="8" />
                </td>
            </tr>
            <tr>
                <td>吨位</td>
                <td>
                    <input type="text" class="wid"  name="weight" value="{$shipmsg['weight']}" maxlength="8" />
                </td>
            </tr>
            <tr>
                <td>刻度值</td>
                <td>
                    <for start="1" end="15">
                    <input type="text" style="width: 50px;margin-right: 10px;margin-top: 5px;" name="kedu[]" maxlength="5" value="{$kedu[$i-1]}"/>
                    </for>
                </td>
            </tr>
            <tr id='tname1' style="display: {@:($shipmsg['suanfa'] == 'c') ? 'block' : 'none'@}">
                <if condition="$shipmsg['suanfa'] == 'c' || $shipmsg['suanfa'] == 'd'">
                    <td>底量表纵倾刻度值</td>
                    <td>
                        <for start="1" end="15">
                        <input type="text" style="width: 50px;margin-right: 10px;margin-top: 5px;" name="kedu1[]" maxlength="5" value="{$kedu1[$i-1]}"/>
                        </for>
                    </td>
                </if>
            </tr>
            <tr>
                <td colspan=2 style="text-align: center;">
                    <input type="submit" name="sub" value="提交" class="btn btn-primary" >
                    <button onclick="match_ship_info()" type="button" class="btn btn-warning"
                            style="margin-left: 50px;">智能识别舱容表信息
                    </button>
                    <button onclick="match_word_ship_info()" type="button" class="btn btn-warning"
                            style="margin-left: 50px;">识别word舱容表信息
                    </button>
                </td>
            </tr>
            </form>
        </table>
    </div>

    <script src="__ADMIN_STATIC__/ajaximg/jquery.min.js"></script>
    <script src="__ADMIN_STATIC__/ajaximg/lrz.all.bundle.js"></script>
    <script type="text/javascript">
    laydate.render({
        elem: '#test1' //指定元素
        ,theme: 'grid' //主题
        ,format: 'yyyy-MM-dd' //自定义格式
        ,min: 0
    });
    //下拉获取cang,单选获取表
    $("select[name=suanfa]").change(function () {
        if($(this).children().is(':selected')){
            var id = $(this).val();
            // var tname = $("#tname");
            var tname1 = $("#tname1");
            if(id == 'c' || id == "d")
            {
                string = '<td style="width:120px;">底量表纵倾刻度值</td><td><input type="text" class="kedu" name="kedu1[]" maxlength="5" required/><input type="text" class="kedu" name="kedu1[]" maxlength="5" required/><input type="text" class="kedu" name="kedu1[]" maxlength="5" required/><input type="text" class="kedu" name="kedu1[]" maxlength="5" required/><input type="text" class="kedu" name="kedu1[]" maxlength="5" required/><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /><input type="text" class="kedu" name="kedu1[]" maxlength="5" /></td>';
                tname1.html(string);
                $("#tname1").show()
            }else{
                $("#tname1").css('display','none');
            }
        }else{
            tname.css('display','none');
        }
    });
    function checkImg(img_id){
        // var img_id=document.getElementById('movie_img').value; //根据id得到值
        var index= img_id.indexOf("."); //得到"."在第几位
        img_id=img_id.substring(index); //截断"."之前的，得到后缀
        if(img_id!=".bmp"&&img_id!=".png"&&img_id!=".gif"&&img_id!=".jpg"&&img_id!=".jpeg"){  //根据后缀，判断是否符合图片格式
              // alert("不是指定图片格式,重新选择"); 
              return '2';
             // document.getElementById('movie_img').value="";  // 不符合，就清除，重新选择
          }
     }


    function match_ship_info() {
        let content = '';
        content += '<form class="layui-form" method="post">';

        content += '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label" style="width: 150px">是否有底量书：</label>\n' +
            '    <div class="layui-input-block">\n' +
            '      <input type="radio" lay-filter="is_diliang" name="is_diliang" value="2" title="无" checked="">\n' +
            '      <input type="radio" lay-filter="is_diliang" name="is_diliang" value="1" title="有">\n' +
            '    </div>\n' +
            '  </div>' +
            '<div class="layui-form-item layui-hide" id="diliang_code">\n' +
            '    <label class="layui-form-label" style="width: 150px">底量书编号：</label>\n' +
            '    <div class="layui-input-block">\n' +
            '      <input type="text" lay-filter="diliang_number" class="layui-text" name="diliang_number" placeholder="请输入底量书编号">\n' +
            '    </div>\n' +
            '</div>';


        content += '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label" style="width: 150px">上传容量书：</label>\n' +
            '   <div class="layui-upload-drag" id="test10">\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <p id="fileSelectTip">点击上传，或将文件拖拽到此处</p>\n' +
            '       </div>\n ' +
            '   </div>\n ';
        //
        // content += '<div class="layui-form-item">\n' +
        //     '    <div class="layui-input-block">\n' +
        //     '      <input type="file" id="testfile15" name="files">\n' +
        //     '    </div>\n' +
        //     '  </div>';

        content += '<div class="layui-form-item">\n' +
            '    <div class="layui-input-block">\n' +
            '      <button type="button" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>\n' +
            '    </div>\n' +
            '  </div>';

        content += '</form>';

        let index = layer.open({
            type: 1,
            title: "识别书内船信息",
            skin: 'layui-layer-rim', //加上边框
            area: ['650px', '450px'], //宽高
            content: content
        });

        layui.use(['form', 'upload'], function () {
            var $ = layui.jquery
                , upload = layui.upload
                , myform = new FormData()
                , form = layui.form;

            form.render();

            //拖拽上传
            upload.render({
                elem: '#test10'
                , auto: false
                , accept: 'file' //允许上传的文件类型
                , acceptMime: 'text/plain'
                , exts: 'txt'
                , drag: true //允许拖拽
                , multiple: false //不允许上传多个
                , choose: function (obj) {
                    var files = obj.pushFile();
                    obj.preview(function (index, file, result) {
                        console.log(file)
                        myform.append('file', file)
                        let fileName = file.name;
                        if(fileName.length>10){
                            fileName=fileName.substring(0,10)+"... .txt";  //使用字符串截取，获取前30个字符，多余的字符使用“......”代替
                        }

                        $("#fileSelectTip").text(fileName+"已选中,再次操作支持更换文件");
                        // console.log(myform.get('file'))
                    })

                }
            });

            form.on('radio(is_diliang)', function(data){
                console.log(data.value); //被点击的radio的value值
                if(data.value == 1){
                    $("#diliang_code").removeClass("layui-hide")
                }else {
                    $("#diliang_code").addClass("layui-hide")
                }
            });

            form.on('submit(demo1)', function (data) {
                if (myform.get('file') !== null) {
                    let is_diliang = $("input[name='is_diliang']:checked").val();
                    let diliang_number = $("input[name='diliang_number']").val();
                    myform.append('is_diliang',is_diliang)
                    myform.append('diliang_number',diliang_number)
                    console.log(diliang_number)
                    if(is_diliang == 1 && diliang_number==""){
                        layer.alert("请输入底量书编号", {
                            icon: 5
                        });
                    }else {
                        $.ajax({
                            url: "{:U('Ship/match_ship_info')}",
                            type: "POST",
                            data: myform,
                            dataType: "json",
                            processData: false,  //tell jQuery not to process the data
                            contentType: false,  //tell jQuery not to set contentType
                            success: function (data) {
                                console.log(data);
                                if (data.state == 1) {
                                    if(data.firm_count ==0){
                                        layer.alert("舱容表内公司未在系统内发现，请检查，如果没有请自行添加", {
                                            icon: 5
                                        });
                                    }else {
                                        //自动选择此公司
                                        $("#firmid option").each(function () {
                                            if ($(this).text() == data.ship_info.firmname) {
                                                $('#firmid').val($(this).val());
                                            }
                                        });
                                    }

                                    $("input[name='shipname']").val(data.ship_info.shipname)
                                    $("input[name='shibie_num']").val(data.ship_info.shibie_num)
                                    $("input[name='number']").val(data.ship_info.number)
                                    $("input[name='expire_time']").val(data.ship_info.expire_time)
                                    $("input[name='cabinnum']").val(data.ship_info.cabinnum)
                                    $("input[name='coefficient']").val(data.ship_info.coefficient)
                                    $("input[name='type']").val(data.ship_info.type)
                                    $("input[name='make']").val(data.ship_info.make)
                                    $("input[name='weight']").val(data.ship_info.weight)
                                    $("input[name='goodsname']").val(data.ship_info.goodsname)
                                    if(data.ship_info.is_guanxian == 1){
                                        $("input[name='is_guanxian']:eq(0)").attr("checked",'checked');
                                    }else {
                                        $("input[name='is_guanxian']:eq(1)").attr("checked",'checked');
                                    }

                                    //自动选择此算法
                                    $("#suanfa option").each(function () {
                                        if ($(this).text() == data.ship_info.suanfa) {
                                            $('#suanfa').val($(this).val());
                                        }
                                    });
                                    if (data.ship_info.suanfa == 'c' || data.ship_info.suanfa == 'd') {
                                        $("#tname1").show()
                                    } else {
                                        $("#tname1").css('display', 'none');
                                    }

                                    let kedu_num = 0;
                                    $("input[name='kedu\[\]']").each(function () {
                                        $(this).val(data.ship_info.kedu[kedu_num])
                                        kedu_num++;
                                    });

                                    let kedu1_num = 0;
                                    $("input[name='kedu1\[\]']").each(function () {
                                        $(this).val(data.ship_info.kedu1[kedu1_num])
                                        kedu1_num++;
                                    });

                                    // let edc = $("#sample-table-1");
                                    // edc.html(data.content);
                                    // console.log(data.cabinnum, cabinnum);
                                    // if (data.cabinnum != cabinnum) {
                                    //     layer.alert("船舶资料的舱数与书内的舱数不符合，请检查", {
                                    //         icon: 5
                                    //     });
                                    // }
                                    layer.close(index);

                                } else {
                                    layer.alert(data.error, {
                                        icon: 5
                                    });
                                }
                            }
                        });
                    }

                }else {
                    layer.alert("请选择文件", {
                        icon: 5
                    });
                }


                return false;
            })
        });
    }

    function match_word_ship_info() {
        let content = '';
        content += '<form class="layui-form" method="post">';

        content += '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label" style="width: 150px">是否有底量书：</label>\n' +
            '    <div class="layui-input-block">\n' +
            '      <input type="radio" lay-filter="is_diliang" name="is_diliang" value="2" title="无" checked="">\n' +
            '      <input type="radio" lay-filter="is_diliang" name="is_diliang" value="1" title="有">\n' +
            '    </div>\n' +
            '  </div>' +
            '<div class="layui-form-item layui-hide" id="diliang_code">\n' +
            '    <label class="layui-form-label" style="width: 150px">底量书编号：</label>\n' +
            '    <div class="layui-input-block">\n' +
            '      <input type="text" lay-filter="diliang_number" class="layui-text" name="diliang_number" placeholder="请输入底量书编号">\n' +
            '    </div>\n' +
            '</div>';


        content += '<div class="layui-form-item">\n' +
            '<div class="layui-inline">\n' +
            '    <label class="layui-form-label" style="width: 150px">上传使用说明：</label>\n' +
            '   <div class="layui-upload-drag" id="test11">\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <p id="fileSelectTip1">点击上传，或将文件拖拽到此处</p>\n' +
            '       </div>\n ' +
            '       </div>\n ' +
            '<div class="layui-inline">\n' +
            '    <label class="layui-form-label" style="width: 150px">上传证书：</label>\n' +
            '   <div class="layui-upload-drag" id="test12">\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <p id="fileSelectTip2">点击上传，或将文件拖拽到此处</p>\n' +
            '       </div>\n ' +
            '       </div>\n ' +
            '<div class="layui-inline">\n' +
            '    <label class="layui-form-label" style="width: 150px">上传舱容表：</label>\n' +
            '   <div class="layui-upload-drag" id="test13">\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <i class="layui-icon"></i>\n' +
            '       <p id="fileSelectTip3">点击上传，或将文件拖拽到此处</p>\n' +
            '       </div>\n ' +
            '       </div>\n ' +
            '   </div>\n ';
        //
        // content += '<div class="layui-form-item">\n' +
        //     '    <div class="layui-input-block">\n' +
        //     '      <input type="file" id="testfile15" name="files">\n' +
        //     '    </div>\n' +
        //     '  </div>';

        content += '<div class="layui-form-item">\n' +
            '    <div class="layui-input-block">\n' +
            '      <button type="button" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>\n' +
            '    </div>\n' +
            '  </div>';

        content += '</form>';

        let index = layer.open({
            type: 1,
            title: "识别书内船信息",
            skin: 'layui-layer-rim', //加上边框
            area: ['620px', '660px'], //宽高
            content: content
        });

        layui.use(['form', 'upload'], function () {
            var $ = layui.jquery
                , upload = layui.upload
                , myform = new FormData()
                , form = layui.form;

            form.render();

            //拖拽上传
            upload.render({
                elem: '#test11'
                , auto: false
                , accept: 'file' //允许上传的文件类型
                , acceptMime: 'text/plain'
                , exts: 'txt'
                , drag: true //允许拖拽
                , multiple: false //不允许上传多个
                , choose: function (obj) {
                    var files = obj.pushFile();
                    obj.preview(function (index, file, result) {
                        console.log(file)
                        myform.append('sysm', file)
                        let fileName = file.name;
                        if(fileName.length>10){
                            fileName=fileName.substring(0,10)+"... .txt";  //使用字符串截取，获取前30个字符，多余的字符使用“......”代替
                        }

                        $("#fileSelectTip1").text(fileName+"已选中,再次操作支持更换文件");
                        // console.log(myform.get('file'))
                    })

                }
            });

            //拖拽上传
            upload.render({
                elem: '#test12'
                , auto: false
                , accept: 'file' //允许上传的文件类型
                , acceptMime: 'text/plain'
                , exts: 'txt'
                , drag: true //允许拖拽
                , multiple: false //不允许上传多个
                , choose: function (obj) {
                    var files = obj.pushFile();
                    obj.preview(function (index, file, result) {
                        console.log(file)
                        myform.append('zs', file)
                        let fileName = file.name;
                        if(fileName.length>10){
                            fileName=fileName.substring(0,10)+"... .txt";  //使用字符串截取，获取前30个字符，多余的字符使用“......”代替
                        }

                        $("#fileSelectTip2").text(fileName+"已选中,再次操作支持更换文件");
                        // console.log(myform.get('file'))
                    })

                }
            });

            //拖拽上传
            upload.render({
                elem: '#test13'
                , auto: false
                , accept: 'file' //允许上传的文件类型
                , acceptMime: 'text/plain'
                , exts: 'txt'
                , drag: true //允许拖拽
                , multiple: false //不允许上传多个
                , choose: function (obj) {
                    var files = obj.pushFile();
                    obj.preview(function (index, file, result) {
                        console.log(file)
                        myform.append('crb', file)
                        let fileName = file.name;
                        if(fileName.length>10){
                            fileName=fileName.substring(0,10)+"... .txt";  //使用字符串截取，获取前30个字符，多余的字符使用“......”代替
                        }

                        $("#fileSelectTip3").text(fileName+"已选中,再次操作支持更换文件");
                        // console.log(myform.get('file'))
                    })

                }
            });

            form.on('radio(is_diliang)', function(data){
                console.log(data.value); //被点击的radio的value值
                if(data.value == 1){
                    $("#diliang_code").removeClass("layui-hide")
                }else {
                    $("#diliang_code").addClass("layui-hide")
                }
            });

            form.on('submit(demo1)', function (data) {
                if (myform.get('crb') !== null && myform.get('zs') !== null && myform.get('sysm') !== null) {
                    let is_diliang = $("input[name='is_diliang']:checked").val();
                    let diliang_number = $("input[name='diliang_number']").val();
                    myform.append('is_diliang',is_diliang)
                    myform.append('diliang_number',diliang_number)
                    console.log(diliang_number)
                    if(is_diliang == 1 && diliang_number==""){
                        layer.alert("请输入底量书编号", {
                            icon: 5
                        });
                    }else {
                        $.ajax({
                            url: "{:U('Ship/match_word_ship_info')}",
                            type: "POST",
                            data: myform,
                            dataType: "json",
                            processData: false,  //tell jQuery not to process the data
                            contentType: false,  //tell jQuery not to set contentType
                            success: function (data) {
                                console.log(data);
                                if (data.state == 1) {

                                    $("input[name='shipname']").val(data.ship_info.shipname)
                                    $("input[name='number']").val(data.ship_info.number)
                                    $("input[name='expire_time']").val(data.ship_info.expire_time)
                                    $("input[name='cabinnum']").val(data.ship_info.cabinnum)
                                    $("input[name='coefficient']").val(data.ship_info.coefficient)
                                    $("input[name='weight']").val(data.ship_info.weight)
                                    $("input[name='goodsname']").val(data.ship_info.goodsname)
                                    if(data.ship_info.is_guanxian == 1){
                                        $("input[name='is_guanxian']:eq(0)").attr("checked",'checked');
                                    }else {
                                        $("input[name='is_guanxian']:eq(1)").attr("checked",'checked');
                                    }

                                    //自动选择此算法
                                    $("#suanfa option").each(function () {
                                        if ($(this).text() == data.ship_info.suanfa) {
                                            $('#suanfa').val($(this).val());
                                        }
                                    });
                                    if (data.ship_info.suanfa == 'c' || data.ship_info.suanfa == 'd') {
                                        $("#tname1").show()
                                    } else {
                                        $("#tname1").css('display', 'none');
                                    }

                                    let kedu_num = 0;
                                    $("input[name='kedu\[\]']").each(function () {
                                        $(this).val(data.ship_info.kedu[kedu_num])
                                        kedu_num++;
                                    });

                                    let kedu1_num = 0;
                                    $("input[name='kedu1\[\]']").each(function () {
                                        $(this).val(data.ship_info.kedu1[kedu1_num])
                                        kedu1_num++;
                                    });

                                    // let edc = $("#sample-table-1");
                                    // edc.html(data.content);
                                    // console.log(data.cabinnum, cabinnum);
                                    // if (data.cabinnum != cabinnum) {
                                    //     layer.alert("船舶资料的舱数与书内的舱数不符合，请检查", {
                                    //         icon: 5
                                    //     });
                                    // }
                                    layer.close(index);

                                } else {
                                    layer.alert(data.error, {
                                        icon: 5
                                    });
                                }
                            }
                        });
                    }

                }else {
                    layer.alert("请选择文件", {
                        icon: 5
                    });
                }


                return false;
            })
        });
    }


    //点击绑定
    function fileSelect1() {
        document.getElementById("photo1").click();
    }
    //图片生成并展示
    $(function() {
        $(document).on('change', '.filepath1', function(e) {
            var str = $(this).attr("name");
            var str1 = $(this).val();
            var res = checkImg(str1);
            if (res == '2') {
                alert("不是指定图片格式,重新选择"); 
                return false;
            }
            lrz(this.files[0], { width: 640, quality: 0.92 })
                .then(function(rst) {
                    $.ajax({
                        url: "{:U('Firm/upload_ajax')}",
                        type: 'post',
                        data: { image: rst.base64, zd: str },
                        dataType: 'json',
                        enctype: 'multipart/form-data',
                        success: function(data) {
                            var obj = eval("(" + data + ")");
                            if (0 == obj.status) {
                                return false;
                            } else {
                                $(".normalFace").css('padding-top', '0px');
                                var src = obj.url;
                                $("input[name=" + str + "]").parent().children("img").attr("src", src);
                                $("input[name='img']").val(src);
                                // alert(src);
                            }
                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown) { //上传失败 
                            alert(XMLHttpRequest.status);
                            alert(XMLHttpRequest.readyState);
                            alert(textStatus);
                        }
                    });
                })
                .catch(function(err) {

                })
                .always(function() {

                });
        });
    });
    </script>
</block>