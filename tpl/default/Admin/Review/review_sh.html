<extend name="Public:base"/>
<block name="title">审核管理</block>
<block name="navtitle">
    <li class="active">
        审核管理
    </li>
    <li class="active">
        修改散货船审核
    </li>
</block>
<block name="activeopen11">class="active open"</block>
<block name="active34">class="active"</block>
<block name="content">
    <style>
        .wid {
            width: 250px;
        }

        .kedu {
            width: 50px;
            margin-right: 10px;
            margin-top: 5px;
        }

    </style>
    <div style="text-align: center"><span style="margin: 10px 0;font-size: xx-large;text-align: center">船信息</span><span
            style="margin-left: 37%;font-size: large;"><strong>发起审核用户：{$ship_after_msg['username']}</strong></span>
    </div>
    <div class="page-container">
        <table id="sample-table-1" class="table table-striped table-bordered table-hover"
               style='width:900px;margin:auto auto;text-align: center;'>
            <tr>
                <td colspan="2">原信息</td>
                <td colspan="2">修改审核信息</td>
            </tr>
            <tr>
                <td style="width:150px;">船名</td>
                <td>
                    <input type="text" class="wid" required name="shipname" maxlength="15"
                           value="{$ship_front_msg['shipname']}"/>
                </td>
                <if condition="$ship_after_msg['shipname'] eq ''">
                    <td style="width:150px;">新船名</td>
                    <td>
                        <input type="text" class="wid" required name="shipname" maxlength="15"
                               value="{$ship_front_msg['shipname']}"/>
                    </td>
                    <else/>
                    <td style="width:150px;color: red;">新船名</td>
                    <td>
                        <input type="text" class="wid" style="color: red" required name="shipname" maxlength="15"
                               value="{$ship_after_msg['shipname']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td>舱总数</td>
                <td>
                    <input type="text" class="wid" required name="cabinnum" maxlength="2"
                           value="{$ship_front_msg['cabinnum']}"/>
                </td>
                <if condition="$ship_after_msg['cabinnum'] eq ''">
                    <td>新舱总数</td>
                    <td>
                        <input type="text" class="wid" required name="cabinnum" maxlength="2"
                               value="{$ship_front_msg['cabinnum']}"/>
                    </td>
                    <else/>
                    <td>新舱总数</td>
                    <td style="color: red;">
                        <input type="text" class="wid" style="color: red;" required name="cabinnum" maxlength="2"
                               value="{$ship_after_msg['cabinnum']}"/>
                    </td>
                </if>

            </tr>
            <tr>
                <td>编号</td>
                <td>
                    <input type="text" class="wid" required name="number" maxlength="50"
                           value="{$ship_front_msg['number']}"/>
                </td>
                <if condition="$ship_after_msg['number'] eq ''">
                    <td>新编号</td>
                    <td>
                        <input type="text" class="wid" required name="number" maxlength="50"
                               value="{$ship_front_msg['number']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新编号</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="number" maxlength="50"
                               value="{$ship_after_msg['number']}"/>
                    </td>
                </if>

            </tr>
            <tr>
                <td>舱容到期时间</td>
                <td>
                    <input class="wid" name="expire_time" required
                           value="{$ship_front_msg['expire_time']|date='Y-m-d',###}">
                </td>

                <if condition="$ship_after_msg['expire_time'] eq ''">
                    <td>新舱容到期时间</td>
                    <td>
                        <input class="wid" name="expire_time" required
                               value="{$ship_front_msg['expire_time']|date='Y-m-d',###}">
                    </td>
                    <else/>
                    <td style="color: red;">新舱容到期时间</td>
                    <td>
                        <input class="wid" style="color: red;" name="expire_time" required
                               value="{$ship_after_msg['expire_time']|date='Y-m-d',###}">
                    </td>
                </if>
            </tr>
            <tr>
                <td>垂线间距</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['lbp']}"/>
                </td>

                <if condition="$ship_after_msg['lbp'] eq ''">
                    <td>新垂线间距</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['lbp']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新垂线间距</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['lbp']}"/>
                    </td>
                </if>

            </tr>
            <tr>
                <td>艏水尺距艏垂线距离</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['df']}"/>
                </td>

                <if condition="$ship_after_msg['df'] eq ''">
                    <td>新艏水尺距艏垂线距离</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['df']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新艏水尺距艏垂线距离</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['df']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td>舯水尺距舯垂线距离</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['dm']}"/>
                </td>

                <if condition="$ship_after_msg['dm'] eq ''">
                    <td>新舯水尺距舯垂线距离</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['dm']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新艉水尺距艉垂线距离</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['dm']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td>艉水尺距艉垂线距离</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['da']}"/>
                </td>

                <if condition="$ship_after_msg['da'] eq ''">
                    <td>新艉水尺距艉垂线距离</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['da']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新艉水尺距艉垂线距离</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['da']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td>表载水密度</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['ptwd']}"/>
                </td>

                <if condition="$ship_after_msg['ptwd'] eq ''">
                    <td>新表载水密度</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['ptwd']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新表载水密度</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['ptwd']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td>船舶自重</td>
                <td>
                    <input type="text" class="wid" required name="suanfa" maxlength="15"
                           value="{$ship_front_msg['weight']}"/>
                </td>

                <if condition="$ship_after_msg['weight'] eq ''">
                    <td>新船舶自重</td>
                    <td>
                        <input type="text" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_front_msg['weight']}"/>
                    </td>
                    <else/>
                    <td style="color: red;">新船舶自重</td>
                    <td>
                        <input type="text" style="color: red;" class="wid" required name="suanfa" maxlength="15"
                               value="{$ship_after_msg['weight']}"/>
                    </td>
                </if>
            </tr>
            <tr>
                <td style="text-align: center;margin: auto 0;line-height:100%;" id="ship_img_text">船舶照片</td>
                <td colspan="3">
                    <div id="ship_img">
                        <if condition="$ship_img_count gt 0">
                            <volist name="shipimg" id="img">
                                <if condition="$img['type'] eq 1">
                                    <img class="normalFace"
                                         layer-src="{:($img['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $img['img']}"
                                         src="{:($img['img'] == '') ? '__PUBLIC__/Admin/noimg.png' : $img['img']}"
                                         onclick="zoom();" alt="test" style='width: 150px;height: 110px;'>
                                </if>
                            </volist>
                            <else/>
                            未上传图片
                        </if>
                    </div>
                </td>
            </tr>
        </table>
        <div style="text-align: center;margin: 10px 0px;">
            <input type="button" name="sub" value="通过" onclick="result({$ship_after_msg['shipid']},2)"
                   class="btn btn-success">
            <input type="button" name="sub" value="拒绝" onclick="result({$ship_after_msg['shipid']},3)"
                   class="btn btn-danger">
        </div>
    </div>

    <script src="__ADMIN_STATIC__/ajaximg/jquery.min.js"></script>
    <script src="__ADMIN_STATIC__/ajaximg/lrz.all.bundle.js"></script>
    <script type="text/javascript">

        function checkImg(img_id) {
            // var img_id=document.getElementById('movie_img').value; //根据id得到值
            var index = img_id.indexOf("."); //得到"."在第几位
            img_id = img_id.substring(index); //截断"."之前的，得到后缀
            if (img_id != ".bmp" && img_id != ".png" && img_id != ".gif" && img_id != ".jpg" && img_id != ".jpeg") {  //根据后缀，判断是否符合图片格式
                // alert("不是指定图片格式,重新选择");
                return '2';
                // document.getElementById('movie_img').value="";  // 不符合，就清除，重新选择
            }
        }

        //点击绑定
        function fileSelect1() {
            document.getElementById("photo1").click();
        }

        function zoom() {

            console.log(1);

            //调用示例
            layer.photos({
                photos: '#ship_img',
            });
        }

        function zoom2() {

            console.log(2);

            //调用示例
            layer.photos({
                photos: '#ship_img2',

            });
        }

        function result(id, resultid) {
            var content_html = "";
            var area = ['200px', 'auto'];
            if (resultid === 2) {
                //通过审核
                content_html = "<input type='hidden' name='remark' id='remark' value='success'><div style='text-align: center'>是否通过该审核？</div>";
            } else if (resultid === 3) {
                //拒绝审核，拒绝需要提供理由
                area = ['450px', 'auto'];
                content_html = "<div class=\"row\" style=\"width: 420px;  margin-left:7px; margin-top:10px; text-align: center\"><label>拒绝理由：<input type='text' name='remark' id='remark'><div style='text-align: center'>请输入拒绝理由，该理由将展示给客户</div></label></div>";
            }


            layer.open({
                id: 1,
                type: 1,
                title: '确认审核',
                skin: 'layui-layer-rim',
                area: area,

                content: content_html
                ,
                btn: ['保存', '取消'],
                btn1: function (index, layero) {
                    let remark = top.$('#remark').val();
                    if (remark == "") {
                        layer.alert("拒绝理由不能为空", {
                            icon: 5
                        });
                        return;
                    }
                    // return;
                    $.ajax({
                        url: "{:U('Review/review_sh_result',array('review_id'=>$ship_after_msg['id'],'shipid'=>$ship_after_msg['shipid']))}",
                        type: "POST",
                        data: {
                            "shipid": id,
                            'result': resultid,
                            'remark': remark,
                        },
                        dataType: "json",
                        success: function (data) {
                            if (data.code == 1) {
                                layer.alert('审核成功', {icon: 6}, function () {
                                    //刷新
                                    window.location.href = "{:U('Review/review_ship_index')}";
                                });
                            } else {
                                layer.alert(data.msg, {
                                    icon: 5
                                });
                            }
                        }
                    });
                },
                btn2: function (index, layero) {
                    layer.close(index);
                }

            });
        }

        $(function () {
            setTimeout(function () {
                var h = $('#cabin_img_text').outerHeight(true);
                var sh = $('#ship_img_text').outerHeight(true);
                $('#cabin_img_text').css({lineHeight: h + "px"});
                $('#ship_img_text').css({lineHeight: sh + "px"});
            }, 0);
            $('input[type!="button"]').attr('readonly', 'true');
            // $('input[type="radio"]').attr('dis', 'true');
            $('select').attr('disabled', 'disabled');
        });
    </script>
</block>